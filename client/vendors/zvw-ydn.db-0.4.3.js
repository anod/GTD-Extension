(function(){function k(a){throw a;}var l=void 0,p=!0,q=null,s=!1;function aa(){return function(){}}function t(a){return function(){return this[a]}}function u(a){return function(){return a}}var v,x=this;function ba(a){a=a.split(".");for(var b=x,c;c=a.shift();)if(b[c]!=q)b=b[c];else return q;return b}
function ca(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function z(a){return a!==l}function A(a){return"array"==ca(a)}function da(a){var b=ca(a);return"array"==b||"object"==b&&"number"==typeof a.length}function B(a){return"string"==typeof a}function fa(a){return"boolean"==typeof a}function C(a){return"number"==typeof a}function ga(a){return"function"==ca(a)}function E(a){var b=typeof a;return"object"==b&&a!=q||"function"==b}function ha(a){return a[ia]||(a[ia]=++ja)}
var ia="closure_uid_"+(1E9*Math.random()>>>0),ja=0;function ka(a,b,c){return a.call.apply(a.bind,arguments)}function la(a,b,c){a||k(Error());if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function ma(a,b,c){ma=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ka:la;return ma.apply(q,arguments)}function na(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,c);return a.apply(this,b)}}var oa=Date.now||function(){return+new Date};
function F(a,b){var c=a.split("."),d=x;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&z(b)?d[e]=b:d=d[e]?d[e]:d[e]={}}function G(a,b){function c(){}c.prototype=b.prototype;a.S=b.prototype;a.prototype=new c};function H(a,b,c,d){this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d}H.prototype.lower=l;H.prototype.upper=l;H.prototype.toJSON=function(){return pa(this)};function qa(a,b,c,d){return new H(a,b,c,d)}function ra(a){var b;A(a)?(b=sa(I(a)),b.push("\uffff")):B(a)?b=a+"\uffff":k(new J);return qa(a,b,s,p)}function pa(a){a=a||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}}
function ta(a){return a==q?q:a instanceof ua?a:a.upper!=q&&a.lower!=q?ua.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):a.upper!=q?ua.upperBound(a.upper,a.upperOpen):a.lower!=q?ua.lowerBound(a.lower,a.lowerOpen):q}
H.prototype.rb=function(a){var b=this.lower,c=this.upper,d=this.lowerOpen,e=this.upperOpen;if(a.lower!=q&&(this.lower==q||a.lower>=this.lower))b=a.lower,d=a.lowerOpen||this.lowerOpen;if(a.upper!=q&&(this.upper==q||a.upper<=this.upper))c=a.upper,e=a.upperOpen||this.upperOpen;return qa(b,c,d,e)};
function va(a,b,c,d){var e,f,g,h;if("^"==a)return ra(b);"<"==a||"<="==a?(e=b,g="<"==a):">"==a||">="==a?(f=b,h=">"==a):"="==a||"=="==a?e=f=b:k(new J("invalid op: "+a));"<"==c||"<="==c?(e=d,g="<"==c):">"==c||">="==c?(f=d,h=">"==c):z(c)&&k(new J("invalid op2: "+c));return qa(f,e,h,g)}var ua=x.IDBKeyRange||x.webkitIDBKeyRange||H;function wa(a){if(!xa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(ya,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(za,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Aa,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Ba,"&quot;"));return a}var ya=/&/g,za=/</g,Aa=/>/g,Ba=/\"/g,xa=/[&<>\"]/;function Ca(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a}
var Da={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"},Ea={"'":"\\'"};
function K(a){a=String(a);if(a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0),f=b,g=c+1,h;if(!(h=Da[d])){if(!(31<e&&127>e))if(d in Ea)d=Ea[d];else if(d in Da)d=Ea[d]=Da[d];else{e=d;h=d.charCodeAt(0);if(31<h&&127>h)e=d;else{if(256>h){if(e="\\x",16>h||256<h)e+="0"}else e="\\u",4096>h&&(e+="0");e+=h.toString(16).toUpperCase()}d=Ea[d]=e}h=d}f[g]=h}b.push('"');return b.join("")};function Fa(a,b){var c,d;2==arguments.length&&B(arguments[1])?(c=p,d=arguments[1].split(".")):d=(c=da(b))?b:arguments;for(c=c?0:1;c<d.length&&!(a=a[d[c]],!z(a));c++);return a}var Ga={};
function Ha(a){a=[a];for(var b=new Ia,c=0,d,e;(e=a.pop())!==l;){0===c%4&&12<c+4&&(b.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=4,0<e.length){a.push(Ga);for(d=e.length;d--;)a.push(e[d]);continue}else b.write(c);else if("number"===d)c+=1,b.write(c),Ja(b,e);else if(e instanceof Date)c+=2,b.write(c),Ja(b,e.valueOf());else if("string"===d){c+=3;b.write(c);c=b;for(d=0;d<e.length;d++){var f=e.charCodeAt(d);126>=f?c.write(f+1):16510>=f?(f-=127,c.write(128|f>>8,f&255)):c.write(192|f>>10,f>>2|255,
(f|3)<<6)}c.write(0)}else if(e===Ga)b.write(0);else return"";c=0}return b.trim().toString()}
function Ja(a,b){var c,d,e;c=b;var f=e=d=0;if(0!==c)if(isFinite(c)){0>c&&(d=1,c=-c);f=0;if(2.2250738585072014E-308<=c){for(e=c;1>e;)f--,e*=2;for(;2<=e;)f++,e/=2;e=f+1023}f=e?Math.floor(4503599627370496*(c/Math.pow(2,f)-1)):Math.floor(c/4.9E-324)}else e=2047,isNaN(c)?f=0x8000000000000:-Infinity===c&&(d=1);c=d;d=e;e=f;c&&(e=0xfffffffffffff-e,d=2047-d);a.write((c?0:128)|d>>4);a.write((d&15)<<4|0|e/281474976710656);e%=281474976710656;c=0|e/4294967296;a.write(c>>8,c&255);e%=4294967296;c=0|e/65536;a.write(c>>
8,c&255);c=e%65536;a.write(c>>8,c&255)}function Ka(a){var b=a.ma()|0,c=b>>7?s:p,d=c?-1:1,e=(b&127)<<4,b=a.ma()|0,e=e+(b>>4);c&&(e=2047-e);for(var b=[c?15-(b&15):b&15],f=6;f--;)b.push(c?255-(a.ma()|0):a.ma()|0);a=0;for(f=7;f--;)a=a/256+b[f];a/=16;return 0===a&&0===e?0:(a+1)*Math.pow(2,e-1023)*d}
function La(a){for(var b=[],c=0,d=0,e=0,f,g;;){f=a.ma();if(0===f||f==q)break;0===c?(g=f>>6,2>g&&!isNaN(f)?b.push(String.fromCharCode(f-1)):(c=g,d=f<<10,e++)):2===c?(b.push(String.fromCharCode(d+f+127)),c=d=e=0):2===e?(d+=f<<2,e++):(b.push(String.fromCharCode(d|f>>6)),c=d=e=0)}return b.join("")}function Ma(a){this.a=q;var b=a.length-1,c=-1;this.ma=function(){return this.a=c<b?parseInt(a[++c]+a[++c],16):q}}
function Ia(){var a=[],b;this.write=function(c){for(var d=0;d<arguments.length;d++)b=arguments[d].toString(16),a.push(2===b.length?b:b="0"+b)};this.toString=function(){return a.length?a.join(""):q};this.trim=function(){for(var b=a.length;"00"===a[--b];);a.length=++b;return this}}function Oa(a,b){var c=Ha(a),d=Ha(b);return c>d?1:c==d?0:-1};function Pa(a){Error.captureStackTrace?Error.captureStackTrace(this,Pa):this.stack=Error().stack||"";a&&(this.message=String(a))}G(Pa,Error);Pa.prototype.name="CustomError";function J(a){Pa.call(this,a);this.name="ydn.error.ArgumentException"}G(J,Pa);G(J,Pa);function Qa(a){Error.captureStackTrace?Error.captureStackTrace(this,Qa):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}G(Qa,Error);Qa.prototype.name="ydn.error.InternalError";function Ra(a,b,c,d,e){if(!(b instanceof H)){var f;B(b)?f=va(b,c,d,e):b!=q?b instanceof H?f=b:E(b)?f=new H(b.lower,b.upper,b.lowerOpen,b.upperOpen):k(new J("Invalid key range: "+b+" of type "+typeof b)):f=q;b=f}this.a=b;this.ca=a}Ra.prototype.ca="";
function Sa(a,b,c){var d="",e=[];if(c)if(c==q||c.lower==q||c.upper==q?0:A(c.lower)&&A(c.upper)?c.lower.length==c.upper.length-1&&"\uffff"==c.upper[c.upper.length-1]&&c.lower.every(function(a,b){return a==c.upper[b]}):!c.lowerOpen&&!c.upperOpen&&c.lower.length==c.upper.length+1&&"\uffff"==c.upper[c.lower.length-1])if(B(a)){var f=K(a),d=f+" LIKE ?";e.push(L(c.lower,b)+"%")}else for(var g=0;g<c.lower.length;g++)0<g&&(d+=" AND "),f=K(a[g]),d+=f+" = ?",e.push(c.lower[g]);else if(c.lower!=q&&c.upper!=q&&
0==Oa(c.lower,c.upper))if(A(b))f=K(a),d=f+" LIKE ?",e.push("%|"+c.lower+"|%");else if(da(c.lower))for(g=0;g<c.lower.length;g++)0<g&&(d+=" AND "),f=K(a[g]),d+=f+" = ?",e.push(L(c.lower[g],b[g]));else f=K(A(a)?a.join(", "):a),d=f+" = ?",e.push(L(c.lower,b));else{if(c.lower!=q)if(A(a))for(var h="=",g=0;g<c.lower.length;g++)0<g&&(d+=" AND "),g==c.lower.length-1&&(h=c.lowerOpen?" > ":" >= "),f=K(a[g]),d+=" "+f+h+"?",f=b?b[g]:l,e.push(L(c.lower[g],f));else h=c.lowerOpen?" > ":" >= ",f=K(a),d+=" "+f+h+"?",
e.push(L(c.lower,b));if(c.upper!=q)if(d+=0<d.length?" AND ":" ",A(a)){h="=";for(g=0;g<a.length;g++){0<g&&(d+=" AND ");g>=c.upper.length-1&&(h=c.upperOpen?" < ":" <= ");var f=K(a[g]),d=d+(" "+f+h+"?"),f=b?b[g]:l,j=c.upper[g],j=j!=q?j:"\uffff";e.push(L(j,f))}}else h=c.upperOpen?" < ":" <= ",f=K(a),d+=" "+f+h+"?",e.push(L(c.upper,b))}return{sql:d,params:e}}Ra.prototype.rb=function(a){if(this.ca!=a.ca)return q;a=this.a!=q&&a.a!=q?this.a.rb(a.a):this.a||a.a;return new Ra(this.ca,a)};var Ta=Array.prototype,Ua=Ta.indexOf?function(a,b,c){return Ta.indexOf.call(a,b,c)}:function(a,b,c){c=c==q?0:0>c?Math.max(0,a.length+c):c;if(B(a))return!B(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Va=Ta.map?function(a,b,c){return Ta.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=B(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},Wa=Ta.some?function(a,b,c){return Ta.some.call(a,b,c)}:function(a,b,c){for(var d=
a.length,e=B(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return p;return s};function Xa(a,b){var c=Ya(a,b,l);return 0>c?q:B(a)?a.charAt(c):a[c]}function Ya(a,b,c){for(var d=a.length,e=B(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1}function Za(a){if(!A(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function $a(a,b){var c=Ua(a,b);0<=c&&Ta.splice.call(a,c,1)}
function ab(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function bb(a,b,c,d){Ta.splice.apply(a,cb(arguments,1))}function cb(a,b,c){return 2>=arguments.length?Ta.slice.call(a,b):Ta.slice.call(a,b,c)}function db(a,b){if(!da(a)||!da(b)||a.length!=b.length)return s;for(var c=a.length,d=eb,e=0;e<c;e++)if(!d(a[e],b[e]))return s;return p}function fb(a,b){return a>b?1:a<b?-1:0}function eb(a,b){return a===b};/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
*/
function M(a,b){this.a=[];this.i=b||q}v=M.prototype;v.Za=s;v.Ha=s;v.sb=s;v.tc=s;v.dc=s;v.uc=0;v.Pb=function(a,b){this.sb=s;hb(this,a,b)};function hb(a,b,c){a.Za=p;a.b=c;a.Ha=!b;ib(a)}function jb(a){a.Za&&(a.dc||k(new kb),a.dc=s)}function lb(a,b){jb(a);hb(a,p,b)}function mb(a,b){jb(a);hb(a,s,b)}v.fa=function(a,b){return this.L(a,q,b)};v.Mb=function(a,b){return this.L(q,a,b)};v.rc=function(a,b){return this.L(a,a,b)};v.L=function(a,b,c){this.a.push([a,b,c]);this.Za&&ib(this);return this};
function nb(a){return Wa(a.a,function(a){return ga(a[1])})}function ib(a){a.d&&(a.Za&&nb(a))&&(x.clearTimeout(a.d),delete a.d);a.e&&(a.e.uc--,delete a.e);for(var b=a.b,c=s,d=s;a.a.length&&!a.sb;){var e=a.a.shift(),f=e[0],g=e[1],e=e[2];if(f=a.Ha?g:f)try{var h=f.call(e||a.i,b);z(h)&&(a.Ha=a.Ha&&(h==b||h instanceof Error),a.b=b=h);b instanceof M&&(d=p,a.sb=p)}catch(j){b=j,a.Ha=p,nb(a)||(c=p)}}a.b=b;d&&(b.L(ma(a.Pb,a,p),ma(a.Pb,a,s)),b.tc=p);c&&(a.d=x.setTimeout(function(){k(b)},0))}
function ob(a){var b=new M;lb(b,a);return b}function kb(){Pa.call(this)}G(kb,Pa);kb.prototype.message="Deferred has already fired";kb.prototype.name="AlreadyCalledError";function pb(){return new M}var qb={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},rb=x.webkitIDBRequest&&"LOADING"in x.webkitIDBRequest?x.webkitIDBTransaction||x.IDBTransaction:x.IDBRequest&&"LOADING"in x.IDBRequest?x.IDBTransaction:qb,N=rb.READ_ONLY,sb=rb.READ_WRITE,tb=rb.VERSION_CHANGE;function vb(a,b){return a?b?"prevunique":"prev":b?"nextunique":"next"};function wb(a,b){for(var c=da(b),d=c?b:arguments,c=c?0:1;c<d.length&&!(a=a[d[c]],!z(a));c++);return a}var xb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function yb(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<xb.length;f++)c=xb[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var zb,Ab,Bb,Cb;function Db(){return x.navigator?x.navigator.userAgent:q}Cb=Bb=Ab=zb=s;var Eb;if(Eb=Db()){var Fb=x.navigator;zb=0==Eb.indexOf("Opera");Ab=!zb&&-1!=Eb.indexOf("MSIE");Bb=!zb&&-1!=Eb.indexOf("WebKit");Cb=!zb&&!Bb&&"Gecko"==Fb.product}var Hb=zb,Ib=Ab,Jb=Cb,Mb=Bb;function Nb(){var a=x.document;return a?a.documentMode:l}var Ob;
a:{var Pb="",Qb;if(Hb&&x.opera)var Rb=x.opera.version,Pb="function"==typeof Rb?Rb():Rb;else if(Jb?Qb=/rv\:([^\);]+)(\)|;)/:Ib?Qb=/MSIE\s+([^\);]+)(\)|;)/:Mb&&(Qb=/WebKit\/(\S+)/),Qb)var Sb=Qb.exec(Db()),Pb=Sb?Sb[1]:"";if(Ib){var Tb=Nb();if(Tb>parseFloat(Pb)){Ob=String(Tb);break a}}Ob=Pb}var Ub={};
function Vb(a){var b;if(!(b=Ub[a])){b=0;for(var c=String(Ob).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",j=/(\d*)(\D*)/g,m=/(\d*)(\D*)/g;do{var n=j.exec(g)||["","",""],r=m.exec(h)||["","",""];if(0==n[0].length&&0==r[0].length)break;b=((0==n[1].length?0:parseInt(n[1],10))<(0==r[1].length?0:parseInt(r[1],10))?-1:(0==n[1].length?0:parseInt(n[1],10))>(0==r[1].length?
0:parseInt(r[1],10))?1:0)||((0==n[2].length)<(0==r[2].length)?-1:(0==n[2].length)>(0==r[2].length)?1:0)||(n[2]<r[2]?-1:n[2]>r[2]?1:0)}while(0==b)}b=Ub[a]=0<=b}return b}var Wb=x.document,Xb=!Wb||!Ib?l:Nb()||("CSS1Compat"==Wb.compatMode?parseInt(Ob,10):5);function Yb(a){return Zb(a||arguments.callee.caller,[])}
function Zb(a,b){var c=[];if(0<=Ua(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push($b(a)+"(");for(var d=a.arguments,e=0;e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=$b(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(Zb(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?
c.push("[...long stack...]"):c.push("[end]");return c.join("")}function $b(a){if(ac[a])return ac[a];a=String(a);if(!ac[a]){var b=/function ([^\(]+)/.exec(a);ac[a]=b?b[1]:"[Anonymous]"}return ac[a]}var ac={};function cc(a,b,c,d,e){"number"==typeof e||dc++;d||oa();this.d=b;delete this.b;delete this.a}cc.prototype.b=q;cc.prototype.a=q;var dc=0;function ec(a){this.i=a}ec.prototype.a=q;ec.prototype.d=q;ec.prototype.b=q;function fc(a,b){this.name=a;this.value=b}fc.prototype.toString=t("name");var gc=new fc("SEVERE",1E3),hc=new fc("WARNING",900),ic=new fc("INFO",800),jc=new fc("CONFIG",700),kc=new fc("FINE",500),lc=new fc("FINER",400),mc=new fc("FINEST",300);ec.prototype.getName=t("i");function nc(a){return a.d?a.d:a.a?nc(a.a):q}
ec.prototype.log=function(a,b,c){if(a.value>=nc(this).value){a="log:"+this.e(a,b,c).d;x.console&&(x.console.timeStamp?x.console.timeStamp(a):x.console.markTimeline&&x.console.markTimeline(a));x.msWriteProfilerMark&&x.msWriteProfilerMark(a);for(a=this;a;)a=a.a}};
ec.prototype.e=function(a,b,c){var d=new cc(0,String(b));if(c){d.b=c;var e;var f=arguments.callee.caller;try{var g;var h=ba("window.location.href");if(B(c))g={message:c,name:"Unknown error",lineNumber:"Not available",fileName:h,stack:"Not available"};else{var j,m,n=s;try{j=c.lineNumber||c.Tc||"Not available"}catch(r){j="Not available",n=p}try{m=c.fileName||c.filename||c.sourceURL||x.$googDebugFname||h}catch(w){m="Not available",n=p}g=n||!c.lineNumber||!c.fileName||!c.stack?{message:c.message,name:c.name,
lineNumber:j,fileName:m,stack:c.stack||"Not available"}:c}e="Message: "+wa(g.message)+'\nUrl: <a href="view-source:'+g.fileName+'" target="_new">'+g.fileName+"</a>\nLine: "+g.lineNumber+"\n\nBrowser stack:\n"+wa(g.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+wa(Yb(f)+"-> ")}catch(y){e="Exception trying to expose exception! You win, we lose. "+y}d.a=e}return d};function oc(a,b){a.log(gc,b,l)}function P(a,b){a.log(hc,b,l)}function pc(a,b){a.log(kc,b,l)}function S(a,b){a.log(lc,b,l)}
function T(a,b){a.log(mc,b,l)}var qc={},rc=q;function U(a){rc||(rc=new ec(""),qc[""]=rc,rc.d=jc);var b;if(!(b=qc[a])){b=new ec(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=U(a.substr(0,c));c.b||(c.b={});c.b[d]=b;b.a=c;qc[a]=b}return b};function W(a,b,c,d,e,f){B(a)||k(new J("store name must be a string"));this.J=a;this.index=b;this.U=z(f)?f:!!B(this.index);fa(this.U)||k(new J("key_only"));z(d)&&!fa(d)&&k(new J("reverse"));z(e)&&!fa(e)&&k(new J("unique"));a="next";d&&e?a="prevunique":d?a="prev":e&&(a="nextunique");this.direction=a;this.I=ta(c);this.Ya=[];this.Rb=[];this.Sb=[];this.ub=[];this.tb=[];this.d=0;this.D=this.b=this.a=l;this.Ja=s}
function sc(a,b,c){3<arguments.length&&k(new J("too many argument"));W.call(this,a,l,b,c,l,p)}G(sc,W);function tc(a,b,c,d,e){B(b)||k(new J("index name must be string"));W.call(this,a,b,c,d,e,p)}G(tc,W);function uc(a,b,c){3<arguments.length&&k(new J("too many argument"));W.call(this,a,l,b,c,l,s)}G(uc,W);function vc(a,b,c,d,e){B(b)||k(new J("index name must be string"));W.call(this,a,b,c,d,e,s)}G(vc,W);v=W.prototype;v.ic=U("ydn.db.Iterator");v.Hc=t("J");v.ta=t("index");v.D=l;v.Ja=s;v.k=t("a");
v.Gc=function(){return B(this.index)?this.b:this.a};v.gc=function(){return this.I?this.I instanceof ua?this.I:ua.bound(this.I.lower,this.I.upper,this.I.lowerOpen,this.I.upperOpen):q};v.U=p;v.Ic=t("U");v.toJSON=function(){return{store:this.J,index:this.index,key_range:this.I?pa(this.I):q,direction:this.direction}};v.toString=function(){return"Iterator:"+this.J+(z(this.index)?":"+this.index:"")};v.key=t("a");v.Cc=function(a,b){this.a=a;this.b=b};v.Fc=t("d");v.wc=t("D");v.stores=function(){return[this.J].concat(this.gb)};
v.gb=[];v.sc=[];v.hc=function(){return"prev"===this.direction||"prevunique"===this.direction};v.Jc=function(){return"nextunique"===this.direction||"prevunique"===this.direction};v.Ya=[];v.Rb=[];v.Sb=[];v.ub=[];v.tb=[];function wc(a){a.a=A(a.a)?ab(a.a):a.a;a.b=A(a.b)?ab(a.b):a.b;a.Ja=s;a.D=s;T(a.ic,a+": exited")}
function xc(a,b,c,d){if(0<a.Ya.length){var e,f,g=a.D===s;g?(e=a.a,f=a.b):a.d=0;a.Ja=p;var h=[],j=d.b(b,c,a.J,a.index,a.I,a.direction,a.U);j.wa(e,f,g);j.q=function(b,c){z(b)?(a.D=s,a.a=b,a.b=c,m()&&n()):(a.D=p,a.Ja=s)};e=function(b,c,d){m();z(c)&&(a.ub[b]=c,a.tb[b]=d);m()&&n()};for(f=0;f<a.Ya.length;f++)g=d.b(b,c,a.Sb[f]||a.J,a.Ya[f],a.Rb[f],a.direction,p),g.wa(a.ub[f],a.tb[f]),h.push(g),g.q=na(e,f);var m=function(){return!h.some(function(a){return a.V})},n=function(){for(var b=s,c=p,d=[],e=a.a,f=
0;f<h.length;f++){var g=h[f];if(g.Z()){var m=yc(a.a,g.k());d[f]=m;1===m?c=s:-1===m&&(c=s,b=p,1===yc(g.k(),e)&&(e=g.k()))}else c=s}if(c){j.t(j.k(),j.Y(),j.ea());for(f=0;f<h.length;f++)h[f].forward(p)}else if(b){e!=a.a&&j.Va(e);for(f=0;f<h.length;f++)0==d[f]?h[f].A(e):-1==d[f]?h[f].A(e):h[f].Z()?e!=h[f].k()&&h[f].A(e):h[f].A(e)}else{a.a!=e&&j.A(e);for(f=0;f<h.length;f++)(!h[f].Z()||0!==yc(h[f].k(),e))&&h[f].A(e)}};b=j}else{var r;(e=a.D===s)?(g=a.a,r=a.b):a.d=0;a.D=l;var w=d.b(b,c,a.J,a.index,a.I,a.direction,
a.U);T(a.ic,a+" created "+w);w.q=function(b,c,d){z(b)?(a.a=b,a.b=c,a.d++,w.t(b,c,d)):(a.D=p,w.t(l,l,l))};w.wa(g,r,e);b=w}return b}v.Kc=function(){"working"==(z(this.D)?this.D===s?this.Ja?"working":"resting":"completed":"initial")&&k(new zc("working"));this.d=0;this.D=this.b=this.a=l};function Ac(a){Error.captureStackTrace?Error.captureStackTrace(this,Ac):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.InvalidKeyException"}G(Ac,Error);function Bc(a){Error.captureStackTrace?Error.captureStackTrace(this,Bc):this.stack=Error().stack||"";a&&(this.message=String(a))}G(Bc,Error);Bc.prototype.name="ydn.db.InternalError";
function Cc(a){Error.captureStackTrace?Error.captureStackTrace(this,Cc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"}G(Cc,Error);function Dc(a){Error.captureStackTrace?Error.captureStackTrace(this,Dc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidAccessError"}G(Dc,Error);function Ec(a){Error.captureStackTrace?Error.captureStackTrace(this,Ec):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"}
G(Ec,Error);Ec.prototype.name="NotFoundError";function Fc(a,b){Error.captureStackTrace?Error.captureStackTrace(this,Fc):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message+" ["+a.code+"]";this.name="SQLError"}G(Fc,Error);function Gc(a,b){Error.captureStackTrace?Error.captureStackTrace(this,Gc):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message;this.name="SecurityError"}G(Gc,Error);
function Hc(a){Error.captureStackTrace?Error.captureStackTrace(this,Hc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.SqlParseError"}G(Hc,Error);function Ic(a,b,c){var d;E(a)?(d=a.store,b=a.id,a.parent!=q&&(c=new Ic(a.parent))):z(b)?d=a:(d=a.lastIndexOf("^|"),b=a,0<d&&(b=a.substr(d),c=new Ic(a.substring(0,d))),b=b.split("^:"),d=b[0],b=b[1],z(b)||k(Error("Invalid key value: "+a)));this.a=d;this.id=b;this.b=c||q}v=Ic.prototype;v.toJSON=function(){var a={store:this.a,id:this.id};this.b&&(a.parent=this.b.toJSON());return a};v.valueOf=function(){return(this.b?this.b.valueOf()+"^|":"")+this.a+"^:"+this.id};
v.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};v.Mc=t("a");v.xc=t("id");v.Lc=t("b");function Jc(a,b){this.sa=a;this.a=b}Jc.prototype.c=U("ydn.db.core.req.RequestExecutor");Jc.prototype.sa="";function Kc(a){Error.captureStackTrace?Error.captureStackTrace(this,Kc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"}G(Kc,Error);function Lc(a){Error.captureStackTrace?Error.captureStackTrace(this,Lc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotSupportedException"}G(Kc,Error);Lc.prototype.name="ydn.error.NotSupportedException";
function Mc(a){Error.captureStackTrace?Error.captureStackTrace(this,Mc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotImplementedException"}G(Mc,Error);function Nc(a){Error.captureStackTrace?Error.captureStackTrace(this,Nc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}G(Nc,Error);Nc.prototype.name="ydn.InternalError";
function Oc(a){Error.captureStackTrace?Error.captureStackTrace(this,Oc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstrainError"}G(Oc,Error);function Pc(a){Error.captureStackTrace?Error.captureStackTrace(this,Pc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationException"}G(Kc,Error);
function zc(a){Error.captureStackTrace?Error.captureStackTrace(this,zc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationError"}G(zc,Error);U("ydn");function sa(a){if(!B(a)||/^[\s\xa0]*$/.test(a))return{};try{return JSON.parse(a)}catch(b){k(b)}}function I(a){return JSON.stringify(a)};function Qc(a,b){Jc.call(this,a,b)}G(Qc,Jc);v=Qc.prototype;v.c=U("ydn.db.core.req.IndexedDb");v.Wa=function(a,b,c,d){function e(b){var m=a.objectStore(d[b]).count();m.onsuccess=function(a){g[b]=a.target.result;b++;b==d.length?(S(f.c,"success "+h),c(g),c=q):e(b)};m.onerror=function(a){P(f.c,"error "+h);c(a,p);c=q}}var f=this,g=[],h="TxNo:"+b+" countStores: "+d;T(this.c,h);0==d.length?(c([]),c=q):e(0)};
v.pb=function(a,b,c,d,e,f){a=a.objectStore(d);var g="TxNo:"+b+" addObject: "+d+" "+f;T(this.c,g);var h=this,j;j=z(f)?a.add(e,f):a.add(e);j.onsuccess=function(a){T(h.c,"success "+g);c(a.target.result)};j.onerror=function(){T(h.c,"error "+g);c(j.error||Error(),p)}};
v.Ab=function(a,b,c,d,e,f){a=a.objectStore(d);var g="TxNo:"+b+" putObject: "+d+" "+(z(f)?f:"");T(this.c,g);var h=this;b=z(f)?a.put(e,f):a.put(e);b.onsuccess=function(a){T(h.c,"success "+g);c(a.target.result)};b.onerror=function(a){T(h.c,"error "+g);c(a,p)}};
v.qb=function(a,b,c,d,e,f){function g(a){var b;b=f!=q?n.add(e[a],f[a]):n.add(e[a]);b.onsuccess=function(b){j++;h[a]=b.target.result;j==e.length?(T(m.c,"success "+r),c(h)):(b=a+10,b<e.length&&g(b))};b.onerror=function(a){j++;T(m.c,"error "+r);c(a,p)}}var h=[],j=0,m=this,n=a.objectStore(d),r="TxNo:"+b+" addObjects: "+d+" "+e.length+" objects";T(this.c,r);if(0<e.length)for(a=0;10>a&&a<e.length;a++)g(a);else c([])};
v.Bb=function(a,b,c,d,e,f){function g(a){var b;b=f!=q?w.put(e[a],f[a]):w.put(e[a]);b.onsuccess=function(b){m++;j[a]=b.target.result;m==e.length?h():(b=a+10,b<e.length&&g(b))};b.onerror=function(c){m++;j[a]=b.error||c.target.result;n=p;m==e.length?h():(c=a+10,c<e.length&&g(c))}}function h(){n?(T(r.c,"error "+y),c(j,p)):(T(r.c,"success "+y),c(j))}var j=[],m=0,n=s,r=this,w=a.objectStore(d),y="TxNo:"+b+" putObjects: "+d+" "+e.length+" objects";T(this.c,y);if(0<e.length)for(a=0;10>a&&a<e.length;a++)g(a);
else c([])};
v.$b=function(a,b,c,d,e){function f(b){var c=e[b],n=a.objectStore(c.a),r;r=n.keyPath===q?n.put(d[b],c.id):n.put(d[b]);r.onsuccess=function(a){j++;h[b]=a.target.result;j==d.length?g():(a=b+10,a<d.length&&f(a))};r.onerror=function(a){j++;h[b]=r.error||a.target.result;m=p;j==d.length?g():(a=b+10,a<d.length&&f(a))}}function g(){m?(T(n.c,"error "+r),c(h,p)):(T(n.c,"success "+r),c(h))}var h=[],j=0,m=s,n=this,r="TxNo:"+b+" putByKeys: of "+d.length+" objects";T(this.c,r);if(0<d.length)for(b=0;10>b&&b<d.length;b++)f(b);
else g()};v.Cb=function(a,b,c,d,e){var f=this;a=a.objectStore(d);var g="TxNo:"+b+" clearById: "+d+" "+e;T(this.c,g);b=a.openCursor(e);b.onsuccess=function(a){var b=a.target.result;b?(b=b["delete"](),b.onsuccess=function(){T(f.c,"success "+g);c(1)},b.onerror=function(){c(a,p)}):c(l)};b.onerror=function(a){T(f.c,"error "+g);c(a,p)}};
v.bc=function(a,b,c,d,e){var f=this,g=a.objectStore(d);a=g.count(e);var h="TxNo:"+b+" clearByKeyRange: "+d+" "+e;T(this.c,h);a.onsuccess=function(a){var b=a.target.result;a=g["delete"](e);a.onsuccess=function(){T(f.c,"success "+h);c(b)};a.onerror=function(a){T(f.c,"error "+h);c(a,p)}};a.onerror=function(a){T(f.c,"count error "+h);c(a,p)}};
v.Nb=function(a,b,c,d,e){var f=this;a=a.objectStore(d);var g="TxNo:"+b+" clearByKeyRange: "+d+" "+e;T(this.c,g);b=a["delete"](e);b.onsuccess=function(){T(f.c,"success "+g);c(l)};b.onerror=function(a){T(f.c,"error "+g);c(a,p)}};
v.ac=function(a,b,c,d,e,f){var g=this;a=a.objectStore(d).index(e);var h="TxNo:"+b+" clearByIndexKeyRange: "+d+":"+e+" "+f;T(this.c,h);b=a.openCursor(f);var j=0;b.onsuccess=function(a){var b=a.target.result;b?(a=b["delete"](),a.onsuccess=function(){j++;b["continue"]()},a.onerror=function(a){T(g.c,"error "+h);k(a)}):(T(g.c,"success "+h),c(j))};b.onerror=function(a){T(g.c,"error "+h);c(a,p)}};
v.Ta=function(a,b,c,d){var e=this,f=d.length,g=0,h="TxNo:"+b+" clearByStores: "+d;T(this.c,h);for(b=0;b<f;b++){var j=a.objectStore(d[b]).clear();j.onsuccess=function(){g++;g==f&&(T(e.c,"success "+h),c(g))};j.onerror=function(a){g++;g==f&&(T(e.c,"error "+h),c(a,p))}}};
function Rc(a,b,c,d,e,f,g,h,j,m,n){var r=[];b=b.objectStore(e);h=vb(h,n);var w="TxNo:"+c+" listByKeyRange: "+e+(f?":"+f:"")+(g?I(g):"");T(a.c,w);c=f?b.index(f).openCursor(g,h):b.openCursor(g,h);var y=s;c.onsuccess=function(b){if(b=b.target.result)if(!y&&0<m)y=p,b.advance(m);else if(r.push(b.value),r.length<j)b["continue"]();else T(a.c,"success "+w),d(r);else T(a.c,"success "+w),d(r)};c.onerror=function(b){T(a.c,"error "+w);d(b,p)}}v.Na=function(a,b,c,d,e,f,g,h){Rc(this,a,b,c,d,q,e,f,g,h)};
v.Ma=function(a,b,c,d,e,f,g,h,j,m){Rc(this,a,b,c,d,e,f,g,h,j,m)};v.Wb=function(a,b,c,d,e,f,g,h){var j=[],m=this;a=a.objectStore(d);f=vb(f);var n="TxNo:"+b+" keysByKeyRange: "+d+" "+e;T(this.c,n);b=a.openCursor(e,f);var r=s;b.onsuccess=function(a){if(a=a.target.result)if(!r&&0<h)r=p,a.advance(h);else if(j.push(a.key),j.length<g)a["continue"]();else T(m.c,"success "+n),c(j);else T(m.c,"success "+n),c(j)};b.onerror=function(a){T(m.c,"error "+n);c(a,p)}};
v.Vb=function(a,b,c,d,e,f,g,h,j,m){var n=[],r=this;a=a.objectStore(d).index(e);var w="TxNo:"+b+" keysByStore: "+d+":"+e+" "+f;T(this.c,w);b=a.openKeyCursor(f,vb(g,m));var y=s;b.onsuccess=function(a){if(a=a.target.result)if(!y&&0<j)y=p,a.advance(j);else{if(n.push(a.primaryKey),n.length<h)a["continue"]()}else T(r.c,"success "+w),c(n)};b.onerror=function(a){T(r.c,"error "+w);c(a,p)}};
v.$a=function(a,b,c,d,e){var f=this,g="TxNo:"+b+" getById: "+d+":"+e;T(this.c,g);a=a.objectStore(d).get(e);a.onsuccess=function(a){T(f.c,"success "+g);c(a.target.result)};a.onerror=function(a){T(f.c,"error "+g);c(a,p)}};
v.wb=function(a,b,c,d,e){function f(a){if(e[a]==q)if(j++,h[a]=l,j==n)T(g.c,"success "+r),c(h);else{var b=a+10;b<n&&f(b)}var d;try{d=m.get(e[a])}catch(V){"DataError"==V.name&&k(new Ac(e[a])),k(V)}d.onsuccess=function(b){j++;h[a]=b.target.result;j==n?(T(g.c,"success "+r),c(h)):(b=a+10,b<n&&f(b))};d.onerror=function(a){j++;T(g.c,"error "+r);c(a,p)}}var g=this,h=[],j=0,m=a.objectStore(d),n=e.length,r="TxNo:"+b+" listByIds: "+d+":"+n+" ids";T(this.c,r);if(0<n)for(a=0;10>a&&a<n;a++)f(a);else c([])};
v.xb=function(a,b,c,d){function e(b){var n=d[b],n=a.objectStore(n.a).get(n.id);n.onsuccess=function(a){h++;g[b]=a.target.result;h==d.length?(T(f.c,"success "+j),c(g)):(a=b+10,a<d.length&&e(a))};n.onerror=function(a){h++;T(f.c,"error "+j);c(a,p)}}var f=this,g=[],h=0,j="TxNo:"+b+" listByKeys: "+d.length+" ids";T(this.c,j);if(0<d.length)for(b=0;10>b&&b<d.length;b++)e(b);else c([])};
v.ra=function(a,b,c,d,e,f){var g=this;a=a.objectStore(d);var h="TxNo:"+b+" countKeyRange: "+d+(f?":"+f:"")+(e?":"+I(e):"");T(this.c,h);f!=q?(b=a.index(f),e=e!=q?b.count(e):b.count()):e=e!=q?a.count(e):a.count();e.onsuccess=function(a){T(g.c,"success "+h);c(a.target.result)};e.onerror=function(a){T(g.c,"error "+h);c(a,p)}};function Sc(){0!=Tc&&(Uc[ha(this)]=this)}var Tc=0,Uc={};Sc.prototype.N=s;Sc.prototype.B=function(){if(!this.N&&(this.N=p,this.ua(),0!=Tc)){var a=ha(this);delete Uc[a]}};Sc.prototype.ua=function(){if(this.O)for(;this.O.length;)this.O.shift()()};var Vc;if(!(Vc=!Ib))Vc=Ib&&9<=Xb;var Wc=Vc,Xc=Ib&&!Vb("9");!Mb||Vb("528");Jb&&Vb("1.9b")||Ib&&Vb("8")||Hb&&Vb("9.5")||Mb&&Vb("528");Jb&&!Vb("8")||Ib&&Vb("9");function Yc(a,b){this.type=a;this.a=this.target=b}Yc.prototype.B=aa();Yc.prototype.b=s;Yc.prototype.d=p;Yc.prototype.e=function(){this.d=s};function Zc(a){Zc[" "](a);return a}Zc[" "]=aa();function $c(a,b){a&&ad(this,a,b)}G($c,Yc);$c.prototype.target=q;$c.prototype.i=q;function ad(a,b,c){var d=a.type=b.type;Yc.call(a,d);a.target=b.target||b.srcElement;a.a=c;if((c=b.relatedTarget)&&Jb)try{Zc(c.nodeName)}catch(e){}a.i=b;b.defaultPrevented&&a.e();delete a.b}$c.prototype.e=function(){$c.S.e.call(this);var a=this.i;if(a.preventDefault)a.preventDefault();else if(a.returnValue=s,Xc)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var bd=0;function cd(){}cd.prototype.key=0;cd.prototype.na=s;cd.prototype.Sa=s;cd.prototype.handleEvent=function(a){return this.a?this.ha.call(this.vb||this.src,a):this.ha.handleEvent.call(this.ha,a)};var dd={},ed={},fd={},gd={};
function hd(a,b,c,d,e){if(A(b))for(var f=0;f<b.length;f++)hd(a,b[f],c,d,e);else{a:{b||k(Error("Invalid event type"));d=!!d;var g=ed;b in g||(g[b]={M:0,v:0});g=g[b];d in g||(g[d]={M:0,v:0},g.M++);var g=g[d],f=ha(a),h;g.v++;if(g[f]){h=g[f];for(var j=0;j<h.length;j++)if(g=h[j],g.ha==c&&g.vb==e){if(g.na)break;h[j].Sa=s;a=h[j];break a}}else h=g[f]=[],g.M++;var m=id,n=Wc?function(a){return m.call(n.src,n.ha,a)}:function(a){a=m.call(n.src,n.ha,a);if(!a)return a},j=n,r=g=new cd;ga(c)?r.a=p:c&&c.handleEvent&&
ga(c.handleEvent)?r.a=s:k(Error("Invalid listener argument"));r.ha=c;r.b=j;r.src=a;r.type=b;r.capture=!!d;r.vb=e;r.Sa=s;r.key=++bd;r.na=s;g.Sa=s;j.src=a;j.ha=g;h.push(g);fd[f]||(fd[f]=[]);fd[f].push(g);a.addEventListener?(a==x||!a.Qb)&&a.addEventListener(b,j,d):a.attachEvent(b in gd?gd[b]:gd[b]="on"+b,j);a=g}dd[a.key]=a}}
function jd(a,b,c,d,e){if(A(b))for(var f=0;f<b.length;f++)jd(a,b[f],c,d,e);else{d=!!d;a:{f=ed;if(b in f&&(f=f[b],d in f&&(f=f[d],a=ha(a),f[a]))){a=f[a];break a}a=q}if(a)for(f=0;f<a.length;f++)if(a[f].ha==c&&a[f].capture==d&&a[f].vb==e){kd(a[f].key);break}}}
function kd(a){var b=dd[a];if(b&&!b.na){var c=b.src,d=b.type,e=b.b,f=b.capture;c.removeEventListener?(c==x||!c.Qb)&&c.removeEventListener(d,e,f):c.detachEvent&&c.detachEvent(d in gd?gd[d]:gd[d]="on"+d,e);c=ha(c);fd[c]&&(e=fd[c],$a(e,b),0==e.length&&delete fd[c]);b.na=p;if(b=ed[d][f][c])b.Yb=p,ld(d,f,c,b);delete dd[a]}}
function ld(a,b,c,d){if(!d.eb&&d.Yb){for(var e=0,f=0;e<d.length;e++)d[e].na?d[e].b.src=q:(e!=f&&(d[f]=d[e]),f++);d.length=f;d.Yb=s;0==f&&(delete ed[a][b][c],ed[a][b].M--,0==ed[a][b].M&&(delete ed[a][b],ed[a].M--),0==ed[a].M&&delete ed[a])}}function md(a,b,c,d,e){var f=1;b=ha(b);if(a[b]){var g=--a.v,h=a[b];h.eb?h.eb++:h.eb=1;try{for(var j=h.length,m=0;m<j;m++){var n=h[m];n&&!n.na&&(f&=nd(n,e)!==s)}}finally{a.v=Math.max(g,a.v),h.eb--,ld(c,d,b,h)}}return Boolean(f)}
function nd(a,b){a.Sa&&kd(a.key);return a.handleEvent(b)}
function id(a,b){if(a.na)return p;var c=a.type,d=ed;if(!(c in d))return p;var d=d[c],e,f;if(!Wc){e=b||ba("window.event");var g=p in d,h=s in d;if(g){if(0>e.keyCode||e.returnValue!=l)return p;a:{var j=s;if(0==e.keyCode)try{e.keyCode=-1;break a}catch(m){j=p}if(j||e.returnValue==l)e.returnValue=p}}j=new $c;ad(j,e,this);e=p;try{if(g){for(var n=[],r=j.a;r;r=r.parentNode)n.push(r);f=d[p];f.v=f.M;for(var w=n.length-1;!j.b&&0<=w&&f.v;w--)j.a=n[w],e&=md(f,n[w],c,p,j);if(h){f=d[s];f.v=f.M;for(w=0;!j.b&&w<n.length&&
f.v;w++)j.a=n[w],e&=md(f,n[w],c,s,j)}}else e=nd(a,j)}finally{n&&(n.length=0)}return e}c=new $c(b,this);return e=nd(a,c)};function od(){Sc.call(this)}G(od,Sc);v=od.prototype;v.Qb=p;v.zb=q;v.addEventListener=function(a,b,c,d){hd(this,a,b,c,d)};v.removeEventListener=function(a,b,c,d){jd(this,a,b,c,d)};
function pd(a,b){var c=b,d=c.type||c,e=ed;if(d in e){if(B(c))c=new Yc(c,a);else if(c instanceof Yc)c.target=c.target||a;else{var f=c,c=new Yc(d,a);yb(c,f)}var f=1,g,e=e[d],d=p in e,h;if(d){g=[];for(h=a;h;h=h.zb)g.push(h);h=e[p];h.v=h.M;for(var j=g.length-1;!c.b&&0<=j&&h.v;j--)c.a=g[j],f&=md(h,g[j],c.type,p,c)&&c.d!=s}if(s in e)if(h=e[s],h.v=h.M,d)for(j=0;!c.b&&j<g.length&&h.v;j++)c.a=g[j],f&=md(h,g[j],c.type,s,c)&&c.d!=s;else for(e=a;!c.b&&e&&h.v;e=e.zb)c.a=e,f&=md(h,e,c.type,s,c)&&c.d!=s}}
v.ua=function(){od.S.ua.call(this);var a=0;if(this!=q){var b=ha(this);if(fd[b])for(var b=fd[b],c=b.length-1;0<=c;c--)kd(b[c].key),a++}else for(c in b=function(b,c){kd(c);a++},dd)b.call(l,0,c);this.zb=q};function qd(a,b,c){ga(a)?c&&(a=ma(a,c)):a&&"function"==typeof a.handleEvent?a=ma(a.handleEvent,a):k(Error("Invalid listener argument"));2147483647<b||x.setTimeout(a,b||0)};function rd(a,b){Jc.call(this,a,b)}G(rd,Jc);v=rd.prototype;v.pb=function(a,b,c,d,e,f){a=sd(a,e,d,f);c(a)};v.Ab=function(a,b,c,d,e,f){a=sd(a,e,d,f);c(a)};v.qb=function(a,b,c,d,e,f){b=[];for(var g=0;g<e.length;g++)b[g]=sd(a,e[g],d,z(f)?f[g]:l);c(b)};v.Bb=function(a,b,c,d,e,f){b=[];for(var g=0;g<e.length;g++)b[g]=sd(a,e[g],d,z(f)?f[g]:l);c(b)};v.$a=function(a,b,c,d,e){c(td(a,d,e))};v.wb=function(a,b,c,d,e){b=[];for(var f=0;f<e.length;f++){var g=td(a,d,e[f]);b.push(g)}c(b)};v.Na=aa();
v.xb=function(a,b,c,d){b=[];for(var e=0;e<d.length;e++){var f=td(a,d[e].a,d[e].id);b.push(f)}c(b)};v.Ma=aa();v.Cb=function(a,b,c,d,e){ud(a,d,e);c(p)};v.Ta=function(a,b,c,d){for(b=0;b<d.length;b++)ud(a,d[b]);c(p)};v.Wa=function(a,b,c,d){qd(function(){for(var b=[],f=0;f<d.length;f++){var g=a.ab(d[f]);b[f]=g.length}c(b)},0,this)};v.ra=function(a,b,c,d){b="_database_"+this.sa;z(d)&&(b+="-"+d);d=0;for(var e in a)a.hasOwnProperty(e)&&0==e.lastIndexOf(b,0)&&d++;c(d)};function vd(a,b){Jc.call(this,a,b)}G(vd,Jc);v=vd.prototype;v.c=U("ydn.db.core.req.WebSql");function wd(a,b){var c=a._default_?sa(a._default_):{};if(b.keyPath!=q){var d=xd(a[b.keyPath],b.type);d!=q&&yd(b,c,d)}for(d=0;d<b.indexes.length;d++){var e=b.indexes[d];if("_default_"!=e.name){var f=a[e.name],f=e.multiEntry?xd(f,[e.type]):xd(f,e.type);z(f)&&(c[e.name]=f)}}return c}v.Wb=function(a,b,c,d,e,f,g,h){zd(this,a,b,c,p,d,l,e,f,g,h,s)};v.Vb=function(a,b,c,d,e,f,g,h,j,m){zd(this,a,b,c,p,d,e,f,g,h,j,m)};
function zd(a,b,c,d,e,f,g,h,j,m,n,r){var w=[],y=X(a.a,f);f=g!=q;var D=B(g)?Ad(y,g):q,V=g||Bd(y);g=D?D.p():y.p();var Q=f?D.type:y.type,V=K(V),R=Bd(y),O="*";e&&(O=K(R));r="SELECT "+(r?"DISTINCT":"")+O+" FROM "+Cd(y);O=[];h!==q&&(h=Sa(g,f&&D.multiEntry?[Q]:Q,h),r+=" WHERE "+h.sql,O=h.params);r+=" ORDER BY "+V+" "+(j?"DESC":"ASC");C(m)&&(r+=" LIMIT "+m);C(n)&&(r+=" OFFSET "+n);var ea="TxNo:"+c+" SQL: "+r+" PARAMS: "+I(O);T(a.c,ea);b.executeSql(r,O,function(b,c){for(var f=0,g=c.rows.length;f<g;f++){var h=
c.rows.item(f);e?w[f]=xd(h[R],y.type):h!=q&&(w[f]=wd(h,y))}S(a.c,"success "+ea);d(w)},function(b,c){P(a.c,"error: "+ea+c.message);d(c,p);return s})}v.pb=function(a,b,c,d,e,f){Fd(this,a,b,c,p,p,d,[e],[f])};v.Ab=function(a,b,c,d,e,f){Fd(this,a,b,c,s,p,d,[e],[f])};v.qb=function(a,b,c,d,e,f){Fd(this,a,b,c,p,s,d,e,f)};
function Fd(a,b,c,d,e,f,g,h,j){function m(b,g){var Q;Q=z(j)?Gd(n,h[b],j[b]):Gd(n,h[b]);var R=r+Cd(n)+" ("+Q.Ob.join(", ")+") VALUES ("+Q.ec.join(", ")+");",O="TxNo:"+c+" SQL: "+R+" PARAMS: "+Q.z;T(a.c,O);g.executeSql(R,Q.z,function(c,e){y++;var g=z(Q.key)?Q.key:e.insertId;f?(T(a.c,"success "+R),d(g)):(w[b]=g,y==h.length?(T(a.c,"success "+O),d(w)):(g=b+2,g<h.length&&m(g,c)))},function(c,g){y++;if(6==g.code&&e)if(f)S(a.c,"success "+O),d(g,p);else if(w[b]=q,y==h.length)T(a.c,"success "+O),d(w);else{var j=
b+2;j<h.length&&m(j,c)}else P(a.c,"error: "+g.message+" "+O),d(g,p);return s})}var n=X(a.a,g),r=e?"INSERT INTO ":"INSERT OR REPLACE INTO ",w=[],y=0;if(0<h.length)for(g=0;2>g&&g<h.length;g++)m(g,b);else S(a.c,"success"),d([])}v.Bb=function(a,b,c,d,e,f){Fd(this,a,b,c,s,s,d,e,f)};
v.$b=function(a,b,c,d,e){if(0==e.length)c([]);else{for(var f=[],g=0,h=0,j=this,m=function(m,n){var r=[];T(j.c,"put "+n.length+" objects to "+m);for(var w,y=(w=!!X(j.a,m).keyPath)?l:[],D=0;D<n.length;D++)r.push(d[n[D]]),w||y.push(e[n[D]].id);Fd(j,a,b,function(a,b){if(b)g++,g==h&&c(a,p);else{for(var d=0;d<n.length;d++)f[n[d]]=a[d];g++;g==h&&c(f)}},s,s,m,r,y)},n="",r=[],w=[],y=0;y<e.length;y++){var D=e[y].a,V=e[y].id;D!=n?(h++,0<r.length&&m(n,r),r=[y],w=[V],n=D):(r.push(y),w.push(V))}0<r.length&&m(n,
r)}};v.$a=function(a,b,c,d,e){var f=X(this.a,d),g=this;d=Hd(f);e=[L(e,f.type)];var h="SELECT * FROM "+Cd(f)+" WHERE "+d+" = ?",j="TxNo"+b+" SQL: "+h+" PARAMS: "+e;T(this.c,j);a.executeSql(h,e,function(a,b){T(g.c,"success "+h);if(0<b.rows.length){var d=b.rows.item(0);d!=q?(d=wd(d,f),c(d)):(S(g.c,"success: "+j),c(l))}else S(g.c,"success: "+j),c(l)},function(a,b){P(g.c,"error: "+j+" "+b.message);c(b,p);return s})};
v.wb=function(a,b,c,d,e){function f(a,d){var w=e[a],y=Hd(m),w=[L(w,m.type)],D="SELECT * FROM "+Cd(m)+" WHERE "+y+" = ?";T(g.c,"SQL: "+D+" PARAMS: "+w);d.executeSql(D,w,function(d,r){j++;if(0<r.rows.length){var w=r.rows.item(0);w!=q&&(h[a]=wd(w,m))}else h[a]=l;j==e.length?(S(g.c,"TxNo:"+b+"success "+D),c(h)):(w=a+10,w<e.length&&f(w,d))},function(d,m){j++;P(g.c,"error: "+D+" "+m.message);if(j==e.length)S(g.c,"TxNo:"+b+"success "+D),c(h);else{var r=a+10;r<e.length&&f(r,d)}return s})}var g=this,h=[],
j=0,m=X(this.a,d);if(0<e.length)for(d=0;10>d&&d<e.length;d++)f(d,a);else S(g.c,"success"),c([])};v.Na=function(a,b,c,d,e,f,g,h){zd(this,a,b,c,s,d,l,e,f,g,h,s)};v.Ma=function(a,b,c,d,e,f,g,h,j,m){zd(this,a,b,c,s,d,e,f,g,h,j,m)};
v.xb=function(a,b,c,d){function e(a,b){var n=d[a],r=X(f.a,n.a),w=A(n.id)?n.id.join("^|"):n.id,n=Hd(r),w=[w],y="SELECT * FROM "+Cd(r)+" WHERE "+n+" = ?";T(f.c,"SQL: "+y+" PARAMS: "+w);b.executeSql(y,w,function(b,m){h++;if(0<m.rows.length){var n=m.rows.item(0);n!=q&&(g[a]=wd(n,r))}else g[a]=l;h==d.length?(T(f.c,"success "+y),c(g)):(n=a+10,n<d.length&&e(n,b))},function(a,b){P(f.c,"error: "+y+" "+b.message);c(b,p);return s})}var f=this,g=[],h=0;if(0<d.length)for(b=0;10>b&&b<d.length;b++)e(b,a);else T(this.c,
"success"),c([])};v.Ta=function(a,b,c,d){function e(a,b){var j="DELETE FROM  "+Cd(X(f.a,d[a]));T(f.c,"SQL: "+j+" PARAMS: []");b.executeSql(j,[],function(b){a==d.length-1?(T(f.c,"success "+j),c(d.length)):e(a+1,b)},function(a,b){P(f.c,"error: "+j+" "+b.message);c(b,p);return s})}var f=this;0<d.length?e(0,a):(T(this.c,"success"),c(0))};
v.Cb=function(a,b,c,d,e){b=X(this.a,d);e=L(e,b.type);var f=this,g="DELETE FROM "+Cd(b)+" WHERE "+(B(b.keyPath)?K(b.keyPath):l)+" = ?";T(this.c,"SQL: "+g+" PARAMS: "+[e]);a.executeSql(g,[e],function(a,b){T(f.c,"success "+g);c(b.rowsAffected)},function(a,b){P(f.c,"error: "+g+" "+b.message);c(b,p);return s})};v.Nb=function(a,b,c,d,e){Id(this,a,c,d,l,e)};v.bc=function(a,b,c,d,e){Id(this,a,c,d,l,e)};v.ac=function(a,b,c,d,e,f){Id(this,a,c,d,e,f)};
function Id(a,b,c,d,e,f){var g=X(a.a,d);d=g.type;z(e)?d=Ad(g,e).type:e=Bd(g);var h="DELETE FROM "+Cd(g),g=[];f!==q&&(e=Sa(e,d,f),h+=" WHERE "+e.sql,g=e.params);T(a.c,"SQL: "+h+" PARAMS: "+g);b.executeSql(h,g,function(b,d){T(a.c,"success "+h);c(d.rowsAffected)},function(b,d){P(a.c,"error: "+h+" "+d.message);c(d,p);return s})}
v.Wa=function(a,b,c,d){function e(b){var j="SELECT COUNT(*) FROM "+K(d[b]);T(f.c,"SQL: "+j+" PARAMS: []");a.executeSql(j,[],function(a,n){var r=n.rows.item(0);g[b]=parseInt(r["COUNT(*)"],10);b++;T(f.c,b+". success "+j);b==d.length?c(g):e(b)},function(a,b){P(f.c,"error: "+j+" "+b.message);c(b,p);return s})}var f=this,g=[];0==d.length?(T(this.c,"success"),c(0)):e(0);return c};
v.ra=function(a,b,c,d,e,f){var g=this,h="SELECT COUNT(*) FROM "+K(d);b=[];d=X(this.a,d);if(e!==q)if(z(f)){var j=Ad(d,f);d=j.keyPath;var m=j.type;if(A(m)){h+=" WHERE ";if(e.lower!=q)if(A(m))for(var n="=",r=0;r<e.lower.length;r++)0<r&&(h+=" AND "),r==e.lower.length-1&&(n=e.lowerOpen?" > ":" >= "),j=K(d[r]),h+=" "+j+n+"?",b.push(L(e.lower[r],m[r]));else n=e.lowerOpen?" > ":" >= ",j=K(f),h+=" "+j+n+"?",b.push(L(e.lower,m));if(e.upper!=q)if(h+=0<h.length?" AND ":" ",A(m)){n="=";for(r=0;r<e.upper.length;r++)0<
r&&(h+=" AND "),r==e.upper.length-1&&(n=e.upperOpen?" < ":" <= "),j=K(d[r]),h+=" "+j+n+"?",b.push(L(e.upper[r],m[r]))}else n=e.upperOpen?" < ":" <= ",j=K(f),h+=" AND "+j+n+"?",b.push(L(e.upper,m))}else e=Sa(d,m,e),h+=" WHERE "+e.sql,b=e.params}else j=Bd(d),e=Sa(j,d.type,e),h+=" WHERE "+e.sql,b=e.params;T(this.c,"SQL: "+h+" PARAMS: "+b);a.executeSql(h,b,function(a,b){var d=b.rows.item(0);T(g.c,"success "+h);c(d["COUNT(*)"])},function(a,b){P(g.c,"error: "+h+" "+b.message);c(b,p);return s});return c};var Jd="serial parallel atomic-serial multirequest-serial samescope-multirequest-serial atomic-parallel multirequest-parallel samescope-multirequest-parallel open single".split(" ");function Kd(a){a?"abort"in a?a.abort():"executeSql"in a?a.executeSql("ABORT",[],aa(),u(p)):k(new Lc):k(new Cc("No active transaction"))};/*
 _try.
*/
function Ld(a){this.f=a;this.a=[];this.Ga=this.b=q;this.P=new Md}v=Ld.prototype;v.ja=U("ydn.db.tr.Serial");v.P=q;v.C=function(){return this.P.b};v.Ga=q;v.type=function(){return this.f.pa()};v.Ub=u(s);v.abort=function(){S(this.ja,this+": aborting");Kd(this.Ga)};
v.xa=function(a,b,c,d){var e=B(b)?[b]:b,f=z(c)?c:N,g=this;this.P.a||(!this.f.b||!this.f.b.kb())&&0<(this.b!==q)?(c=a,T(this.ja,"Serial push tx queue "+c.name),this.a.push({la:c,G:b,mode:f,Q:d})):(this.b=d?[d]:[],this.f.transaction(function(c){var d=g.P;d.a=c;d.d=s;d.G=b;d.mode=f;d.b++;d.Q=q;T(g.ja,g+":tx"+g.P.b+I(b)+f+" begin");a(g);for(a=q;g.Ub();)c=g.a.shift(),c.Q&&g.b.push(c.Q),T(g.ja,"pop tx queue in continue "+c.la.name),c.la()},e,f,function(a,b){T(g.ja,g+":tx"+g.P.b+" committed with "+a);try{for(var c;c=
g.b.shift();)c(a,b)}catch(d){}finally{if(c=g.P,c.a?(c.a=q,c.G=q,c.mode=q,ga(c.Q)&&c.Q(a,b),c.Q=q):P(c.e,c+" has no TX to be unlocked for "+a),c=g.a.shift())T(g.ja,"pop tx queue of "+g.a.length+" "+c.la.name),g.xa(c.la,c.G,c.mode,c.Q)}}))};v.Kb=u(s);
v.h=function(a,b,c,d,e,f){d=d||N;var g=this,h=this.P;if(h.a&&!h.d&&this.Kb(c,d)){var j=h.a,m=function(b,c){g.Ga=j;c?mb(a,b):lb(a,b);m=g.Ga=q};b(j,g.C(),m);b=q}else g.xa(function(){function c(b,e){g.Ga=d;e?mb(a,b):lb(a,b);c=g.Ga=q}var d=h.a;b(d,g.C(),c);b=q},c,d,f)};v.getName=function(){return this.f.getName()};v.toString=u("Serial");function Nd(a){Ld.call(this,a)}G(Nd,Ld);Nd.prototype.ja=U("ydn.db.tr.AtomicSerial");Nd.prototype.h=function(a,b,c,d,e,f){var g,h=s,j=new M;j.L(function(a){g=a},function(a){h=p;g=a});Nd.S.h.call(this,j,b,c,d,e,function(b,c){h?mb(a,g):lb(a,g);f&&(f(b,c),f=l)})};function Od(a,b,c,d,e){z(e)||(e=A(a)?a.join(", "):a);a!=q&&(!B(a)&&!da(a))&&k(new J("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a));!z(a)&&z(e)&&(a=e);this.keyPath=a;this.name=e;this.type=Pd(b);this.unique=!!c;this.multiEntry=!!d}
function L(a,b){if(A(b)){var c=a==q?[""]:A(a)?a:[a],d=c[0]instanceof Date?"d":C(c[0])?"n":"t",c="d"==d?c.reduce(function(a,b){return a+ +b},""):c.join("|");return d+"|"+c+"|"}if("DATE"==b){if(a instanceof Date)return+a}else return z(b)?a:"X'"+Ha(a)+"'"}
function xd(a,b){if(A(b)){if(B(a)){var c=a.split("|"),d=c[0],c=c.slice(1,c.length-1);return Va(c,function(a){return"d"==d?new Date(parseInt(a,10)):"n"==d?parseFloat(a):a})}}else{if("DATE"==b)c=new Date(a);else if(z(b))c=a;else{for(var e=c=[],f,g=[],h,j,m=new Ma(a);m.ma()!=q;)if(0===m.a)e=g.pop();else{if(m.a===q)break;do{h=m.a/4|0;f=m.a%4;for(var n=0;n<h;n++)j=[],e.push(j),g.push(e),e=j;if(0===f&&12<m.a+4)m.ma();else break}while(1);1===f?e.push(Ka(m)):2===f?e.push(new Date(Ka(m))):3===f?e.push(La(m)):
0===f&&(e=g.pop())}c=c[0]}return c}}var Qd=["BLOB","DATE","INTEGER","NUMERIC","TEXT"];function Pd(a){if(A(a))return Va(a,function(a){return Pd(a)});a=Ua(Qd,a);return Qd[a]}v=Od.prototype;v.getName=t("name");v.toJSON=function(){return{name:this.name,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};v.Ua=function(){var a=A(this.keyPath)?ab(this.keyPath):this.keyPath,b=A(this.type)?ab(this.type):this.type;return new Od(a,b,this.unique,this.multiEntry,this.name)};
function Rd(a,b){return a==q&&b==q?q:a!=q?b!=q?da(a)&&da(b)?db(a,b)?q:"expect: "+a+", but: "+b:Sd(a,b)?q:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b}v.hint=function(a){if(!a)return this;var b=A(this.keyPath)?ab(this.keyPath):this.keyPath,c=A(this.type)?ab(this.type):this.type,d=this.multiEntry;a.multiEntry===p&&"TEXT"==this.type&&(d=p);return new Od(b,c,this.unique,d,a.name)};v.p=t("keyPath");function Td(a,b,c,d,e,f,g){this.name=a;B(this.name)||k(new J("store name must be a string"));this.keyPath=z(b)?b:q;this.keyPath!==q&&(!B(this.keyPath)&&!da(this.keyPath))&&k(new J("keyPath must be a string or array"));this.autoIncrement=c;var h;z(d)&&(h=Pd(d),z(h)||k(new J("type invalid in store: "+this.name)));this.type=z(h)?h:this.autoIncrement?"INTEGER":l;this.a=B(this.keyPath)?this.keyPath.split("."):[];this.indexes=e||[];this.ka=!!f;this.oc=!!g}v=Td.prototype;v.ka=s;v.oc=s;
v.toJSON=function(){for(var a=[],b=0;b<this.indexes.length;b++)a.push(this.indexes[b].toJSON());return{name:this.name,keyPath:this.keyPath,autoIncrement:this.autoIncrement,type:this.type,indexes:a}};function Ud(a){var b=[],c=a.indexes||[];if(A(c))for(var d=0;d<c.length;d++){var e=new Od(c[d].keyPath,c[d].type,c[d].unique,c[d].multiEntry,c[d].name);z(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new Td(a.name,a.keyPath,a.autoIncrement,a.type,b,a.dispatchEvents,a.fixed)}v.Ua=function(){return Ud(this.toJSON())};
v.index=function(a){return this.indexes[a]||q};function Ad(a,b){return Xa(a.indexes,function(a){return a.name==b})}function Vd(a,b){return b==a.keyPath?p:Wa(a.indexes,function(a){return a.name==b})}function Hd(a){return B(a.keyPath)?K(a.keyPath):A(a.keyPath)?K(a.keyPath.join(",")):"_ROWID_"}function Bd(a){return A(a.keyPath)?K(a.keyPath.join(",")):B(a.keyPath)?a.keyPath:"_ROWID_"}function Cd(a){return K(a.name)}
v.hint=function(a){if(!a)return this;var b=this.autoIncrement,c=A(this.keyPath)?ab(this.keyPath):this.keyPath,d=A(this.type)?ab(this.type):this.type,e=Va(this.indexes,function(a){return a.Ua()});A(a.type)&&"TEXT"==d&&(d=ab(a.type));A(a.keyPath)&&(B(c)&&c==a.keyPath.join(","))&&(c=ab(a.keyPath));for(var f=0,g=a.indexes.length;f<g;f++)if(A(a.indexes[f].keyPath))for(var h=a.indexes[f].p(),j=s,m=e.length-1;0<=m;m--)0<=h.indexOf(e[m].p())&&!Vd(a,e[m].getName())&&(e.splice(m,1),j||(e.push(a.indexes[f].Ua()),
j=p));for(f=0;f<e.length;f++)(g=Ad(a,e[f].getName()))&&(e[f]=e[f].hint(g));return new Td(a.name,c,b,d,e)};v.getName=t("name");v.p=t("keyPath");function yd(a,b,c){for(var d=0;d<a.a.length;d++){var e=a.a[d];if(d==a.a.length-1){b[e]=c;break}z(b[e])||(b[e]={});b=b[e]}}
function Gd(a,b,c){var d=[];c=z(c)?c:B(a.keyPath)?wb(b,a.a):l;var e=[];z(c)&&(e=a.keyPath!=q?[B(a.keyPath)?K(a.keyPath):l]:["_ROWID_"],d=[L(c,a.type)]);for(var f=0;f<a.indexes.length;f++){var g=a.indexes[f];if(!(g.name==a.keyPath||"_default_"==g.name)){var h=g.p();if(z(h)){var j=g.type;if(A(h))for(var m=0;m<h.length;m++)z(b[h[m]])&&(g.multiEntry?d.push(L(b[h[m]],[j[m]])):d.push(L(b[h[m]],j[m])),e.push(K(h[m])));else z(b[h])&&(g.multiEntry?d.push(L(b[h],[j])):d.push(L(b[h],j)),e.push(K(h)))}}}if(!a.oc){var f=
{},n;for(n in b)b.hasOwnProperty(n)&&!Vd(a,n)&&(f[n]=b[n]);d.push(I(f));e.push("_default_")}a=[];for(f=d.length-1;0<=f;f--)a[f]="?";return{Ob:e,ec:a,z:d,key:c}}
function Wd(a,b){if(!b)return"missing store: "+a.name;if(a.name!=b.name)return"store name, expect: "+a.name+", but: "+b.name;var c=Rd(a.keyPath,b.keyPath);if(c)return"keyPath, "+c;if(z(a.autoIncrement)&&z(b.autoIncrement)&&a.autoIncrement!=b.autoIncrement)return"autoIncrement, expect:  "+a.autoIncrement+", but: "+b.autoIncrement;if(a.indexes.length!=b.indexes.length)return"indexes length, expect:  "+a.indexes.length+", but: "+b.indexes.length;if(z(a.type)&&z(b.type)&&(da(a.type)?!db(a.type,b.type):
a.type!=b.type))return"data type, expect:  "+a.type+", but: "+b.type;for(c=0;c<a.indexes.length;c++){var d=Ad(b,a.indexes[c].name),e;e=a.indexes[c];if(d)if(e.name!=d.name)e="name, expect: "+e.name+", but: "+d.name;else{var f=Rd(e.keyPath,d.keyPath);e=f?"keyPath, "+f:e.unique!=q&&d.unique!=q&&e.unique!=d.unique?"unique, expect: "+e.unique+", but: "+d.unique:e.multiEntry!=q&&d.multiEntry!=q&&e.multiEntry!=d.multiEntry?"multiEntry, expect: "+e.multiEntry+", but: "+d.multiEntry:z(e.type)&&z(d.type)&&
(da(e.type)?!db(e.type,d.type):e.type!=d.type)?"data type, expect: "+e.type+", but: "+d.type:""}else e="no index for "+e.name;if(0<e.length)return'index "'+a.indexes[c].name+'" '+e}return""};function Xd(a,b){var c,d=b;if(E(a)){c=a.version;for(var d=[],e=a.stores||[],f=0;f<e.length;f++){var g=Ud(e[f]);d.push(g)}}else B(a)?c=0==a.length?l:parseFloat(a):C(a)&&(c=a);z(c)&&((!C(c)||0>c)&&k(new J("Invalid version: "+c+" ("+a+")")),isNaN(c)&&(c=l));z(b)&&(!A(b)||0<b.length&&!(b[0]instanceof Td))&&k(new J("stores"));this.version=c;this.d=!z(this.version);this.stores=d||[]}Xd.prototype.toJSON=function(){var a=this.stores.map(function(a){return a.toJSON()});return{version:this.version,stores:a}};
Xd.prototype.d=s;Xd.prototype.a=u(s);function Yd(a){return a.stores.map(function(a){return a.name})}Xd.prototype.b=function(a){return this.stores[a]||q};function X(a,b){return Xa(a.stores,function(a){return a.name==b})}function Zd(a,b){return Wa(a.stores,function(a){return a.name==b})}
function $d(a,b,c){if(!b||a.stores.length!=b.stores.length)return"Number of store: "+a.stores.length+" vs "+b.stores.length;for(var d=0;d<a.stores.length;d++){var e=X(b,a.stores[d].name),e=e&&c?e.hint(a.stores[d]):e,e=Wd(a.stores[d],e);if(0<e.length)return'store: "'+a.stores[d].name+'" '+e}return""};function ae(a,b){z(a)&&5242880<a&&P(this.j,"storage size request ignored, use Quota Management API instead");this.m=q;this.ib=b||18E4}
ae.prototype.za=function(a,b){function c(a,c,d){S(e.j,(d?"changing":"upgrading")+" version to "+a.version+" from "+g);for(d=0;d<b.stores.length;d++)be(e,a,c,b.stores[d]);c=a.objectStoreNames;var f=c.length;for(d=0;d<f;d++)Zd(b,c[d])||(a.deleteObjectStore(c[d]),S(e.j,"store: "+c[d]+" deleted."))}function d(a,b){z(b)?(P(e.j,b?b.message:"Error received."),e.m=q,mb(f,b)):(e.m=a,e.m.onabort=function(a){T(e.j,e+": onabort - "+a.message)},e.m.onerror=function(a){T(e.j,e+": onerror - "+a.message)},e.m.onversionchange=
function(a){T(e.j,e+": onversionchange to: "+a.version);e.m&&(e.m.onabort=q,e.m.onerror=q,e.m.onversionchange=q,e.m.close(),e.m=q,ga(e.b)&&e.b())},lb(f,parseFloat(g)))}var e=this,f=new M,g=l,h=b.version;S(e.j,"Opening database: "+a+" ver: "+(b.d?"auto":h));var j;j=z(h)?ce.open(a,h):ce.open(a);j.onsuccess=function(f){var h=f.target.result;z(g)||(g=h.version);S(e.j,"Database: "+h.name+", ver: "+h.version+" opened.");if(b.d)e.X(function(f){if(b.a())for(var g=0;g<f.stores.length;g++)if(!Zd(b,f.stores[g].getName())){var j=
f.stores[g].Ua();b.stores.push(j)}f=$d(b,f);if(0<f.length){S(e.j,"Schema change require for difference in "+f);var m=C(h.version)?h.version+1:1;if("IDBOpenDBRequest"in x){h.close();var r=ce.open(a,m);r.onupgradeneeded=function(a){a=a.target.result;S(e.j,"re-open for version "+a.version);c(a,r.transaction,s)};r.onsuccess=function(a){d(a.target.result)};r.onerror=function(){S(e.j,e+": fail.");d(q)}}else{var R=h.setVersion(m+"");R.a=function(a){P(e.j,"migrating from "+h.version+" to "+m+" failed.");
d(q,a)};R.onsuccess=function(){R.transaction.oncomplete=O;c(h,R.transaction,p)};var O=function(){var b=ce.open(a);b.onsuccess=function(a){a=a.target.result;S(e.j,e+": OK.");d(a)};b.onerror=function(){S(e.j,e+": fail.");d(q)}};R.transaction!=q&&(R.transaction.oncomplete=O)}}else d(h)},l,h);else if(b.version>h.version){var j=h.setVersion(b.version);j.a=function(a){P(e.j,"migrating from "+h.version+" to "+b.version+" failed.");d(q,a)};j.onsuccess=function(){c(h,j.transaction,p)}}else b.version==h.version?
S(e.j,"database version "+h.version+" ready to go"):P(e.j,"connected database version "+h.version+" is higher than requested version."),e.X(function(a){a=$d(b,a);0<a.length?(S(e.j,a),d(q,new Oc("different schema: "+a))):d(h)},l,h)};j.onupgradeneeded=function(a){a=a.target.result;g=NaN;S(e.j,"upgrade needed for version "+a.version);c(a,j.transaction,s)};j.onerror=function(c){oc(e.j,"opening database "+a+":"+b.version+" failed.");d(q,c)};j.onblocked=function(c){oc(e.j,"database "+a+" "+b.version+" block, close other connections.");
d(q,c)};C(this.ib)&&qd(function(){"done"!=j.readyState&&(oc(e.j,e+": database state is still "+j.readyState),d(q,Error("connection timeout after "+e.ib)))},this.ib);return f};var ce=x.indexedDB||x.mozIndexedDB||x.webkitIndexedDB||x.moz_indexedDB||x.msIndexedDB;v=ae.prototype;v.ib=18E4;v.Aa=u("indexeddb");v.kb=function(){return!!this.m};v.j=U("ydn.db.con.IndexedDb");v.m=q;v.Fb=function(){return this.m?parseFloat(this.m.version):l};
v.X=function(a,b,c){c=c||this.m;if(z(b)){if(b===q){if(0==c.objectStoreNames.length){a(new Xd(c.version));return}k(new Nc)}c=b.db}else{b=[];for(var d=c.objectStoreNames.length-1;0<=d;d--)b[d]=c.objectStoreNames[d];if(0==b.length){a(new Xd(c.version));return}b=c.transaction(b,N)}for(var e=c.objectStoreNames,f=[],g=e.length,d=0;d<g;d++){for(var h=b.objectStore(e[d]),j=[],m=0,n=h.indexNames.length;m<n;m++){var r=h.index(h.indexNames[m]);j[m]=new Od(r.keyPath,l,r.unique,r.multiEntry,r.name)}f[d]=new Td(h.name,
h.keyPath,h.autoIncrement,l,j)}b=new Xd(c.version,f);a(b)};
function be(a,b,c,d){function e(){var a={autoIncrement:!!d.autoIncrement};d.p()!=q&&(a.keyPath=d.p());try{return b.createObjectStore(d.getName(),a)}catch(c){k(c)}}T(a.j,"Creating Object Store for "+d.getName()+" keyPath: "+d.p());if(b.objectStoreNames.contains(d.getName()))if(c=c.objectStore(d.getName()),(d.p()||"")!=(c.keyPath||""))b.deleteObjectStore(d.getName()),P(a.j,"store: "+d.getName()+" deleted due to keyPath change."),c=e();else if(fa(c.autoIncrement)&&fa(d.autoIncrement)&&c.autoIncrement!=
d.autoIncrement)b.deleteObjectStore(d.getName()),P(a.j,"store: "+d.getName()+" deleted due to autoIncrement change."),c=e();else{for(var f=c.indexNames,g=0,h=0,j=0;j<d.indexes.length;j++){var m=d.indexes[j];if(!f.contains(m.name)){if(m.unique||m.multiEntry){var n={unique:m.unique,multiEntry:m.multiEntry};c.createIndex(m.name,m.keyPath,n)}else c.createIndex(m.name,m.keyPath);g++}}for(j=0;j<f.length;j++)Vd(d,f[j])||(c.deleteIndex(f[j]),h++);T(a.j,"Updated store: "+c.name+", "+g+" index created, "+h+
" index deleted.")}else{c=e();for(j=0;j<d.indexes.length;j++)m=d.indexes[j],T(a.j,"Creating index: "+m.name+" multiEntry: "+m.multiEntry),m.unique||m.multiEntry?(n={unique:m.unique,multiEntry:m.multiEntry},c.createIndex(m.name,m.keyPath,n)):c.createIndex(m.name,m.keyPath);T(a.j,"Created store: "+c.name+" keyPath: "+c.keyPath)}}
v.Xa=function(a,b,c,d){var e=this.m;if(!b){b=[];for(var f=e.objectStoreNames.length-1;0<=f;f--)b[f]=e.objectStoreNames[f]}0==b.length?a(q):(b=e.transaction(b,c),b.oncomplete=function(a){d("complete",a)},b.onerror=function(a){d("error",a)},b.onabort=function(a){d("abort",a)},a(b),a=q)};v.jb=function(){this.m.close()};v.toString=function(){return this.Aa()+":"+(this.m?this.m.name+":"+this.m.version:"")};function de(a){this.a=z(a)?a:4194304}v=de.prototype;
v.za=function(a,b){function c(a,b){z(b)?(d.F=q,mb(f,b)):(d.F=a,lb(f,parseFloat(e)))}var d=this,e=NaN,f=new M,g=q;try{g=x.openDatabase(a,"",a,this.a)}catch(h){"SECURITY_ERR"==h.name?(P(this.n,"SECURITY_ERR for opening "+a),g=q,this.Gb=new Gc(h)):k(h)}if(g){var e=g.version,j="database "+a+(0==g.version.length?"":" version "+g.version);b.version!=q&&b.version==g.version?(pc(d.n,"Existing "+j+" opened as requested."),c(g)):this.X(function(e){if(e=$d(b,e,p)){0==g.version.length?pc(d.n,"New "+j+" created."):
b.d?pc(d.n,"Existing "+j+" opened and  schema change for "+e):pc(d.n,"Existing "+j+" opened and  schema change to version "+b.version+" for "+e);var f=g;e=f.version?parseInt(f.version,10):0;e=b.d?isNaN(e)?1:e+1:b.version;T(d.n,a+": changing version from "+f.version+" to "+e);var h=s,w=0;f.changeVersion(f.version,e+"",function(a){d.X(function(c){h=p;for(var e=0;e<b.stores.length;e++){var f=X(c,b.b(e).getName()),f=f?f.hint(b.b(e)):q;ee(d,a,b.b(e),function(a){a&&w++},f)}if(b instanceof fe)for(e=0;e<
c.stores.length;e++)f=c.b(e),Zd(b,f.getName())||b.stores.push(f)},a,f)},function(a){k(a)},function(){if(h){var e=".";w!=b.stores.length&&(e=" but unexpected stores exists.");T(d.n,a+":"+f.version+" ready"+e);c(f)}else P(d.n,a+": changing version voided.")})}else pc(d.n,"Existing "+j+" with same schema opened."),c(g)},q,g)}else c(q,this.Gb);return f};v.Aa=u("websql");v.Gb=q;v.F=q;v.n=U("ydn.db.con.WebSql");v.Fb=function(){return this.F?parseFloat(this.F.version):l};
v.X=function(a,b,c){function d(a,b){k(b)}function e(b,c){if(c&&c.rows){for(var d=0;d<c.rows.length;d++){var e=c.rows.item(d);if("__WebKitDatabaseInfoTable__"!=e.name&&"sqlite_sequence"!=e.name&&"table"==e.type){var w;w="sql"in e?e.sql:l;T(f.n,"Parsing table schema from SQL: "+w);w=w.substr(w.indexOf("("),w.lastIndexOf(")")).match(/(?:"[^"]*"|[^,])+/g);for(var y=l,D,V=[],Q=s,R=s,O=0;O<w.length;O++){var ea=w[O].match(/\w+|"[^"]+"/g),Na=Va(ea,function(a){return a.toUpperCase()}),ea=Ca(ea[0],'"'),ub=
Pd(Na[1]);-1!=Na.indexOf("PRIMARY")&&-1!=Na.indexOf("KEY")?(B(ea)&&(!/^[\s\xa0]*$/.test(ea)&&"_ROWID_"!=ea)&&(y=ea),D=ub,-1!=Na.indexOf("AUTOINCREMENT")&&(Q=p)):"_default_"==ea?R=p:(Na=new Od(ea,ub,"UNIQUE"==Na[2]),V.push(Na))}e=new Td(e.name,y,Q,D,V,l,!R);h.push(e)}}d=new Xd(g,h);a(d)}}var f=this,g=(c=c||this.F)&&c.version?parseFloat(c.version):l,g=isNaN(g)?l:g,h=[];b?b.executeSql("SELECT * FROM sqlite_master",[],e,d):c.readTransaction(function(b){f.X(a,b,c)},function(a){oc(f.n,"opening tx: "+a.message);
k(a)},e)};
function ee(a,b,c,d,e){function f(a){b.executeSql(a,[],function(){g++;g==h.length&&(d(p),d=q)},function(b,e){g++;g==h.length&&(d(s),d=q);k(new Fc(e,"Error creating table: "+c.name+" "+a))})}var g=0,h,j=c.type||"BLOB";A(j)&&(j="TEXT");var m="CREATE TABLE IF NOT EXISTS "+Cd(c)+" (",m=m+(Hd(c)+" "+j+" UNIQUE PRIMARY KEY ");c.autoIncrement&&(m+=" AUTOINCREMENT ");for(var m=m+" ,_default_ BLOB",j=[],n=[c.p()],r=0,w=c.indexes.length;r<w;r++){var y=c.index(r),D="";y.unique&&(y.multiEntry?P(a.n,'store "'+
c.getName()+'" has both multiEntry and unique set true, but it is not supported under websql'):D=" UNIQUE ");var V=y.p(),Q=y.type;if(A(Q))for(D=0;D<V.length;D++)y=V[D],-1==n.indexOf(y)&&(m+=", "+K(y)+" "+Q[D],n.push(y));else-1==n.indexOf(V)&&(Q=y.multiEntry?"TEXT":y.type||"BLOB",m+=", "+K(V)+" "+Q+D,n.push(V))}j.unshift(m+");");h=j;m="Create";if(e){e=Wd(c,e);if(0==e.length){T(a.n,"same table "+c.name+" exists.");d(p);d=q;return}m="Modify";P(a.n,"table: "+c.name+" has changed by "+e+" additionallly TABLE ALTERATION is not implemented, dropping old table.");
h.unshift("DROP TABLE "+K(c.name))}T(a.n,m+" table: "+c.name+": "+h.join(";"));for(a=0;a<h.length;a++)f(h[a])}v.kb=function(){return!!this.F};v.jb=aa();v.Xa=function(a,b,c,d){function e(a){T(h.n,h+": Tx "+c+" request cause error.");d("error",a)}function f(){d("complete",{type:"complete"})}function g(b){a(b)}var h=this;this.F===q&&(a(q),d("error",this.Gb));c==N?this.F.readTransaction(g,e,f):c==tb?this.F.changeVersion(this.F.version,this.F.version+1+"",g,e,f):this.F.transaction(g,e,f)};var yc=ce&&ce.cmp?ma(ce.cmp,ce):Oa;function ge(a,b,c,d){this.f=a;this.b=b;this.a=d;this.e=c;this.d=q}ge.prototype.g=U("ydn.db.tr.DbOperator");ge.prototype.C=function(){return this.a.C()};ge.prototype.abort=function(){this.a.abort()};function Y(a){a.d||(a.d=a.f.yb(a.e));return a.d}ge.prototype.toString=function(){return"TxStorage:"+this.f.getName()};function he(a,b,c,d){ge.call(this,a,b,c,d)}G(he,ge);v=he.prototype;v.g=U("ydn.db.core.DbOperator");
v.Ba=function(a,b,c){var d=pb(),e=this,f,g,h;if(z(a))if(A(a)){(z(c)||z(b))&&k(new J("too many arguments."));f=a;for(a=0;a<f.length;a++)Zd(this.b,f[a])||k(new J('store name "'+f[a]+'" at '+a+" not found."));S(this.g,"countStores: "+I(f));this.a.h(d,function(a,b,c){Y(e).Wa(a,b,c,f)},f,N,"countStores")}else B(a)?(Zd(this.b,a)||k(new J('store name "'+a+'" not found.')),f=[a],B(b)?(g=b,h=ta(c)):E(b)||!z(b)?(z(c)&&k(new J("Invalid key range or index")),h=ta(b)):k(new J("key range must be an object, but "+
b+" of type "+typeof b+" found.")),S(this.g,"countKeyRange: "+f[0]+" "+(g?g:"")+I(h)),this.a.h(d,function(a,b,c){Y(e).ra(a,b,c,f[0],h,g)},f,N,"countKeyRange")):k(new J("Invalid store name or store names."));else{(z(c)||z(b))&&k(new J("too many arguments."));f=Yd(this.b);var j=new M;S(this.g,"countStores: "+I(f));this.a.h(d,function(a,b,c){Y(e).Wa(a,b,c,f)},f,N,"countStores");d.L(function(a){a=a.reduce(function(a,b){return b+a},0);lb(j,a)},function(a){mb(j,a)});return j}return d};
v.Ca=function(a,b){var c=this,d=pb();if(a instanceof Ic){var e=a.a;if(!Zd(this.b,e)){if(this.b.a())return ob(l);k(new J("Store: "+e+" not found."))}var f=a.id;S(this.g,"getById: "+e+":"+f);this.a.h(d,function(a,b,d){Y(c).$a(a,b,d,e,f)},[e],N,"getById")}else if(B(a)&&z(b)){if(!X(this.b,a)){if(this.b.a())return ob(l);k(new J('Store name "'+a+'" not found.'))}if(b instanceof ua||b instanceof H){var g=new M;g.L(function(a){lb(d,a[0])},function(a){mb(d,a)});var h=ta(b);S(this.g,"getById: "+a+":"+I(h));
this.a.h(g,function(b,d,e){Y(c).Na(b,d,e,a,h,s,1,0)},[a],N,"getById")}else S(this.g,"getById: "+a+":"+b),this.a.h(d,function(d,e,f){Y(c).$a(d,e,f,a,b)},[a],N,"getById")}else k(new J("get require valid input arguments."));return d};
v.keys=function(a,b,c,d,e,f){var g=this,h,j,m=q,n=s,r=X(this.b,a);if(this.b.a()&&!r)return ob([]);r=new M;B(b)?(m=ta(c),C(d)?h=d:(z(d)&&k(new J("limit must be a number")),h=100),C(e)?j=e:(z(e)&&k(new J("offset must be a number")),j=0),z(f)&&(fa?n=f:k(new J("reverse must be a boolean"))),S(this.g,"keysByIndexKeyRange: "+a),this.a.h(r,function(c,d,e){Y(g).Vb(c,d,e,a,b,m,n,h,j,s)},[a],N,"keysByIndexKeyRange")):(m=ta(b),C(c)?h=c:(z(c)&&k(new J("limit must be a number")),h=100),C(d)?j=d:(z(d)&&k(new J("offset must be a number")),
j=0),z(e)&&(fa(e)?n=e:k(new J("reverse must be a boolean"))),S(this.g,"keysByKeyRange: "+a),this.a.h(r,function(b,c,d){Y(g).Wb(b,c,d,a,m,n,h,j)},[a],N,"keysByKeyRange"));return r};
v.z=function(a,b,c,d,e,f){var g=this,h=pb(),j,m,n=s;if(B(a)){if(!X(this.b,a)){if(this.b.a())return ob([]);k(new Ec(a))}if(A(b))S(this.g,"listByIds: "+a+" "+b.length+" ids"),this.a.h(h,function(c,d,e){Y(g).wb(c,d,e,a,b)},[a],N,"listByIds");else if(B(b)){var r=ta(c);z(d)?C(d)?j=d:k(new J("limit must be a number.")):j=100;z(e)?C(e)?m=e:k(new J("offset must be a number.")):m=0;fa(f)?n=f:z(f)&&k(new J("reverse must be a boolean, but "+f));S(this.g,"listByIndexKeyRange: "+a+":"+b);this.a.h(h,function(c,
d,e){Y(g).Ma(c,d,e,a,b,r,n,j,m,s)},[a],N,"listByIndexKeyRange")}else r=ta(b),z(c)?C(c)?j=c:k(new J("limit must be a number, but "+c+" is "+typeof c)):j=100,z(d)?C(d)?m=d:k(new J("offset must be a number, but "+d+" is "+typeof d)):m=0,z(e)&&(fa(e)?n=e:k(new J("reverse must be a boolean, but "+e+" is "+typeof e))),S(this.g,(r?"listByKeyRange: ":"listByStore: ")+a),this.a.h(h,function(b,c,d){Y(g).Na(b,c,d,a,r,n,j,m)},[a],N,"listByKeyRange")}else if(A(a))if(a[0]instanceof Ic){c=[];for(d=0;d<a.length;d++){e=
a[d].a;if(!Zd(this.b,e)){if(this.b.a())return h=[],h[a.length-1]=l,ob(h);k(new J("Store: "+e+" not found."))}0<=Ua(c,e)||c.push(e)}S(this.g,"listByKeys: "+I(c)+" "+a.length+" keys");this.a.h(h,function(b,c,d){Y(g).xb(b,c,d,a)},c,N,"listByKeys")}else k(new J("first argumentmust be array of ydn.db.Key, but "+a[0]+" of "+typeof a[0]+" found."));else k(new J("first argument "+a+" is invalid."));return h};
v.lb=function(a,b,c){var d=B(a)?a:E(a)?a.name:l;B(d)||k(new J("store name "+d+" must be a string, but "+typeof d));var e=X(this.b,d);e?this.b.a()&&E(a)&&(a=Ud(a),(a=Wd(e,a))&&k(new Lc("schema change: "+a))):(this.b.a()||k(new J('store name "'+d+'" not found.')),e=Ud(E(a)?a:{name:d}),S(this.g,"Adding object store: "+d),ie(this.f,e));a=pb();var f=this;e||k(new J('store name "'+d+'" not found.'));B(e.keyPath)&&z(c)&&k(new J("key cannot provide while in-line key is in used."));e.autoIncrement&&z(c)&&
k(new J("key cannot provide while autoIncrement is true."));!B(e.keyPath)&&(!e.autoIncrement&&!z(c))&&k(new J("out-of-line key must be provided."));if(A(b))S(this.g,"addObjects: "+d+" "+b.length+" objects"),this.a.h(a,function(a,e,g){Y(f).qb(a,e,g,d,b,c)},[d],sb,"putObjects"),e.ka&&a.fa(function(a){pd(f.f,new je(ke,f.f,e.getName(),a,b))});else if(E(b)){var g="store: "+d+" key: "+!!e.keyPath?wb(b,e.a):c;S(this.g,"addObject: "+g);this.a.h(a,function(a,e,g){Y(f).pb(a,e,g,d,b,c)},[d],sb,"putObject");
e.ka&&a.fa(function(a){pd(f.f,new le(ke,f.f,e.getName(),a,b))})}else k(new J("record must be an object or array list of objects, but "+b+" of type "+typeof b+" found."));return a};
v.Da=function(a,b,c){var d=pb(),e=this;if(a instanceof Ic){var d=a.a,f=X(this.b,d);f||k(new J('store "'+d+'" not found.'));if(f.keyPath){var g=wb(b,f.a);g!=q?0!=yc(g,a.id)&&k(new J("Inline key must be "+a+" but "+g+" found.")):yd(f,b,a.id);return this.Da(d,b)}return this.Da(d,b,a.id)}if(A(a)){z(c)&&k(new J("too many arguments"));for(var f=[],g=0,h=a.length;g<h;g++){var j=a[g].a;-1==Ua(f,j)&&f.push(j);var m=X(this.b,j);m||k(new J('store "'+j+'" not found.'));m.keyPath&&yd(m,b[g],a[g].id)}S(this.g,
"putByKeys: to "+I(f)+" "+b.length+" objects");this.a.h(d,function(c,d,f){Y(e).$b(c,d,f,b,a)},f,sb,"putByKeys")}else if(B(a)||E(a)){f=B(a)?a:E(a)?a.name:l;B(f)||k(new J("store name must be a string"));(g=X(this.b,f))?this.b.a()&&E(a)&&(h=Ud(a),(h=Wd(g,h))&&k(new Lc("schema change: "+h))):(this.b.a()||k(new Ec(f)),g=Ud(E(a)?a:{name:f}),S(this.g,"Adding object store: "+f),ie(this.f,g));g||k(new Ec(f));var m=g,n=m.getName();B(m.keyPath)&&z(c)&&k(new J("key cannot provide while in-line key is in used."));
m.autoIncrement&&z(c)&&k(new J("key cannot provide while autoIncrement is true."));!B(m.keyPath)&&(!m.autoIncrement&&!z(c))&&k(new J("out-of-line key must be provided."));A(b)?(S(this.g,"putObjects: "+n+" "+b.length+" objects"),this.a.h(d,function(a,d,f){Y(e).Bb(a,d,f,n,b,c)},[n],sb,"putObjects"),m.ka&&d.fa(function(a){pd(e.f,new je(me,e.f,n,a,b))})):E(b)?(S(this.g,"putObject: "+n+" "+c),this.a.h(d,function(a,d,f){Y(e).Ab(a,d,f,n,b,c)},[n],sb,"putObject"),m.ka&&d.fa(function(a){pd(e.f,new le(me,e.f,
n,a,b))})):k(new J("put record value must be Object or array of Objects"))}else k(new J("the first argument of put must be store name, store schema or array of keys."));return d};
v.clear=function(a,b){var c=pb(),d=this;if(B(a))if(X(this.b,a)||k(new J('store name "'+a+'" not found.')),E(b)){var e=ta(b);e===q&&k(new J("clear method requires a valid non-null KeyRange object."));S(this.g,"clearByKeyRange: "+a+":"+I(e));this.a.h(c,function(b,c,f){Y(d).Nb(b,c,f,a,e)},[a],sb,"clearByKeyRange")}else z(b)&&k(new J("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+typeof b)),S(this.g,"clearByStore: "+a),this.a.h(c,function(b,c,e){Y(d).Ta(b,
c,e,[a])},[a],sb,"clearByStores");else if(!z(a)||A(a)&&B(a[0])){var f=a||Yd(this.b);S(this.g,"clearByStores: "+I(f));this.a.h(c,function(a,b,c){Y(d).Ta(a,b,c,f)},f,sb,"clearByStores")}else k(new J('first argument "'+a+'" is invalid.'));return c};
v.mb=function(a,b,c){var d=pb(),e=this;if(B(a)){var f=X(this.b,a);f||k(new J('store name "'+a+'" not found.'));if(z(c))if(B(b)){var g=Ad(f,b);g||k(new J("index: "+b+" not found in "+a));if(E(c)||c===q){var h=ta(c);S(this.g,"removeByIndexKeyRange: "+a+":"+g.getName()+" "+a);this.a.h(d,function(b,c,d){Y(e).ac(b,c,d,a,g.getName(),h)},[a],sb,"removeByIndexKeyRange")}else k(new J("key range "+c+' is invalid type "'+typeof c+'".'))}else k(new J('index name "'+b+'" must be a string, but '+typeof b+" found."));
else B(b)||C(b)||b instanceof DOMStringList||A(b)||b instanceof Date?(S(this.g,"removeById: "+a+":"+b),this.a.h(d,function(c,d,f){Y(e).Cb(c,d,f,a,b)},[a],sb,"removeById"),f.ka&&d.fa(function(b){pd(e.f,new le(ne,e.f,a,b,l))})):E(b)?(h=ta(b),S(this.g,"removeByKeyRange: "+a+":"+I(h)),this.a.h(d,function(b,c,d){Y(e).bc(b,c,d,a,h)},[a],sb,"removeByKeyRange"),f.ka&&d.fa(function(b){pd(e.f,new je(ne,e.f,a,b,l))})):k(new J('Invalid key or key range "'+b+'" of type '+typeof b))}else k(new J('store name required, but "'+
a+'" of type '+typeof a+" found."));return d};v.toString=function(){return"DbOperator:"+this.f.getName()};function oe(a,b,c,d){"transaction"in a?(this.O=a,this.l=this.N=q):"objectStore"in a?(this.O=q,this.N=a.db,this.l=a):k(new Kc("storage instance require."));this.va=b;this.Ka=c;this.La=d;this.e=[];this.d=0;this.i=s}oe.prototype.a=U("ydn.db.con.IdbCursorStream");oe.prototype.i=s;oe.prototype.e=[];function pe(a,b,c){E(a)&&"transaction"in a?(this.Ra=a,this.ia=q):E(a)&&"db"in a?(this.Ra=q,qe(this,a)):k(new J("ydn.db.Streamer: First argument requires storage or transaction instance required."));B(b)||k(new J("a store name required."));this.a=b;z(c)&&!B(c)&&k(new J("index name must be a string."));this.ya=c;this.ia=q;this.aa=[];this.oa=[];this.Ia=s}v=pe.prototype;v.Ra=q;v.f=q;v.Eb=q;v.oa=[];v.aa=[];v.ia=q;v.cc=function(a){this.Eb=a};
function qe(a,b){"db"in b?a.ia=new oe(b,a.a,a.ya,ma(a.ga,a)):k(new J("Invalid IndexedDB Transaction."))}function re(a){var b=0<a.aa.length;if(b&&!a.Ia&&ga(a.Eb)){var c=function(){re(a)},d=a.oa.shift(),e=a.aa.shift(),b=0<a.aa.length,c=a.Eb(d,e,b?c:q);b&&!c&&re(a)}}v.Ia=s;v.vc=function(a){if(this.ia){this.Ia=p;var b=this,c=this.ia,d=function(){a(b.oa,b.aa);b.oa=[];b.aa=[];b.Ia=s};0==c.e.length&&0==c.d?d():c.ga=d}else a(this.oa,this.aa),this.oa=[],this.aa=[]};
v.ga=function(a,b){this.oa.push(a);this.aa.push(b);re(this)};
v.push=function(a,b){this.Ia&&k(new zc(""));if(2<=arguments.length)this.ga(a,b);else{if(!this.ia){this.Ra||k(new zc(""));var c=this.Ra.pa();c?"indexeddb"===c?this.ia=new oe(this.Ra,this.a,this.ya,ma(this.ga,this)):k(new Mc(c)):k(new zc(""))}var d=this.ia;d.e.push(a);if(!d.i){var e=function(a,b){d.l=q;"complete"!==a&&P(d.a,b.name+":"+b.message);T(d.a,d+" transaction "+a)},f=function(a){var b=d.e.shift();T(d.a,d+" transaction started for "+b);var c=a.objectStore(d.va).openCursor(b);d.d++;c.onsuccess=
function(a){if(a=a.target.result){if(ga(d.La)){var b=a.value;d.La(a.primaryKey,d.Ka!=q?b[d.Ka]:b)}else P(d.a,"sink gone, dropping value for: "+a.primaryKey);if(a&&0<d.e.length)a["continue"](d.e.shift());else d.d--,0==d.d&&d.ga&&d.ga()}};c.onerror=function(){P(d.a,"seeking fail. "+("error"in c?c.error.name+":"+c.error.message:""));d.d--;0==d.d&&d.ga&&d.ga()}};d.l?(T(d.a,d+" using existing tx."),f(d.l)):d.N?(T(d.a,d+" creating tx from IDBDatabase."),d.b=d.N.transaction([d.va],N),d.b.oncomplete=function(a){e("complete",
a)},d.b.onerror=function(a){e("error",a)},d.b.onabort=function(a){e("abort",a)}):d.O?(T(d.a,d+" creating tx from ydn.db.con.IStorage."),d.i=p,d.O.transaction(function(a){d.i=s;f(a)},[d.va],N,e)):k(new Nc(""))}}};v.ta=t("ya");v.toString=function(){return"Streamer:"+this.a+(this.ya||"")};function se(a,b,c,d,e,f,g){Sc.call(this);this.Ib=c;this.w=d;this.s=e;this.b=a;this.reverse="prev"==f||"prevunique"==f;this.da=f;this.cb=g}G(se,Sc);v=se.prototype;v.w="";v.Tb="";v.Ib="";v.da="";v.s=q;v.reverse=s;v.cb=p;v.$=function(a){k(a)};v.Hb=function(){return this.w?this.Y():this.k()};v.q=function(a,b,c){this.t(a,b,c)};v.t=aa();v.V=s;v.ua=function(){this.b=q};function te(a,b){this.a=a||q;this.l=b;this.i=0}te.prototype.a=q;te.prototype.b=u(s);te.prototype.d=function(){return[]};function ue(a,b,c,d,e,f,g){se.call(this,a,0,c,d,e,f,g);this.T=this.H=this.o=q;this.ba=s}G(ue,se);v=ue.prototype;v.Ea=U("ydn.db.index.req.IDBCursor");v.o=q;
v.Bc=function(a){var b="IDB"+this;if(this.o=a=a.target.result){if(this.T!=q){b=ce.cmp(a.key,this.T);if(1===b){this.T=this.H=q;this.q(a.primaryKey,a.key,a.value);return}if(0===b)this.T=q;else{a["continue"]();return}}if(this.H!=q)if(b=ce.cmp(this.H,a.primaryKey),0===b)this.H=q,this.ba?(this.ba=s,a["continue"]()):this.q(a.primaryKey,a.key,a.value);else if(1===b)a["continue"]();else this.H=q,this.q(a.primaryKey,a.key,a.value);else this.q(a.primaryKey,a.key,a.value)}else this.H=this.T=q,this.ba=s,T(this.Ea,
b+" completed."),this.q(l,l,l)};v.H=q;v.T=q;v.ba=s;
v.wa=function(a,b,c){var d="IDB"+this;this.H=a;this.T=b;this.ba=!!c;a=this.s;if(b!=q)if(this.s!=q){a=ce.cmp(b,this.s.lower);if(this.reverse&&1==a){T(this.Ea,d+" not opened, index key in reverse out of range "+b+">"+this.s.lower);this.t(l,l,l);return}if(!this.reverse&&-1==a){T(this.Ea,d+" not opened, index key out of range "+b+"<"+this.s.lower);this.t(l,l,l);return}a=ua.bound(b,this.s.upper,s,this.s.upperOpen)}else a=ua.lowerBound(b);b=this.b.objectStore(this.Ib);c=this.w?b.index(this.w):q;T(this.Ea,
d+" opening ");b=this.cb?c?this.da!=q?c.openKeyCursor(a,this.da):a!=q?c.openKeyCursor(a):c.openKeyCursor():this.da!=q?b.openCursor(a,this.da):a!=q?b.openCursor(a):b.openCursor():c?this.da!=q?c.openCursor(a,this.da):a!=q?c.openCursor(a):c.openCursor():this.da!=q?b.openCursor(a,this.da):a!=q?b.openCursor(a):b.openCursor();S(this.Ea,d+" opened, request "+b.readyState);b.onsuccess=ma(this.Bc,this);b.onerror=ma(this.$,this)};v.Z=function(){return!!this.o};v.Y=function(){return this.o.key};v.k=function(){return this.o.primaryKey};
v.ea=function(){return this.o.value};v.Jb=function(a){if(this.o){var b=new M;a=this.o.update(a);a.onsuccess=function(a){lb(b,a.target.result)};a.onerror=function(a){mb(b,a)};return b}k(new Dc("cursor gone"))};v.clear=function(){if(this.o){var a=new M,b=this.o["delete"]();b.onsuccess=function(){lb(a,1)};b.onerror=function(b){mb(a,b)};return a}k(new Dc("cursor gone"))};v.hb=function(a,b){T(this.Ea,this+" restarting.");this.wa(b,a,p)};
v.advance=function(a){this.o||k(new zc(this+" cursor gone."));this.H=this.T=q;this.ba=s;if(1==a)this.o["continue"]();else this.o.advance(a)};v.Va=function(a){this.o||k(new zc(this+" cursor gone."));this.w?(this.T=q,this.H=a,this.ba=s,this.o["continue"]()):(this.H=this.T=q,this.ba=s,this.o["continue"](a))};v.A=function(a){this.o||k(new zc(this+" cursor gone."));this.H=this.T=q;this.ba=s;if(a!=q)this.o["continue"](a);else this.o["continue"]()};v.ua=function(){ue.S.ua.call(this);this.o=q};function ve(a,b){Jc.call(this,a,b)}G(ve,Qc);ve.prototype.c=U("ydn.db.index.req.IndexedDb");ve.prototype.e=function(a,b,c,d,e,f){var g=[],h="keysByIterator:"+d,j=this;T(this.c,h);var m=xc(d,a,b,this);m.$=function(a){P(j.c,"error:"+h);wc(d);m.B();c(a,p)};var n=0,r=s;m.t=function(a,b){z(b)?!r&&0<f?(m.advance(f),r=p):(n++,g.push(b),!z(e)||n<e?m.A():(wc(d),m.B(),T(j.c,"success:"+h),c(g))):(wc(d),m.B(),T(j.c,"success:"+h),c(g))}};
ve.prototype.d=function(a,b,c,d,e,f){var g=[],h="listByIterator"+d+":tx"+b,j=this;T(this.c,h);var m=xc(d,a,b,this);m.$=function(a){P(j.c,"error:"+h);wc(d);m.B();c(a,s)};var n=0,r=s;m.t=function(a,b,D){z(b)?!r&&0<f?(m.advance(f),r=p):(n++,g.push(d.U?a:D),!z(e)||n<e?m.A():(wc(d),T(j.c,"success:"+h),m.B(),c(g))):(wc(d),T(j.c,"success:"+h),m.B(),c(g))}};ve.prototype.b=function(a,b,c,d,e,f,g){return new ue(a,0,c,d,e,f,g)};function we(a,b,c,d,e,f,g,h,j){se.call(this,a,0,d,e,g,h,j);this.Tb=f;this.a=c;this.K=q;this.r=NaN}G(we,se);v=we.prototype;v.qa=U("ydn.db.index.req.WebsqlCursor");v.K=q;v.r=NaN;
v.wa=function(a,b,c){var d=this.s;if(this.w&&b!=q)if(this.s!=q){d=ce.cmp(b,this.s.upper);if(1==d||0==d&&!this.s.upperOpen){this.t(l,l,l);return}d=ua.bound(b,this.s.upper,s,this.s.upperOpen)}else d=ua.lowerBound(b);var e=this,f=["SELECT"];b=[];var g=Bd(this.a),h=this.w?Ad(this.a,this.w):q,j=h?h.type:this.a.type,m=h?h.p():this.a.p()||g,n=K(g),g=" ORDER BY ";if(this.cb)if(A(j)){for(var r=[],w=[],y=0;y<m.length;y++){var D=K(m[y]);r.push(D);D=this.reverse?D+" DESC":D+" ASC";w.push(D)}h&&(r.push(n),w.push(n+
this.reverse?" DESC":" ASC"));f.push(r.join(", "));g+=w.join(", ")}else h?(f.push(K(m)+", "+n),g+=this.reverse?K(m)+" DESC, "+n+" DESC ":K(m)+" ASC, "+n+" ASC "):(f.push(n),g=g+n+(this.reverse?" DESC":" ASC"));else f.push("*"),h?g+=this.reverse?K(m)+" DESC, "+n+" DESC ":K(m)+" ASC, "+n+" ASC ":(g+=n,g+=this.reverse?" DESC":" ASC");f.push("FROM "+K(this.Ib));d=Sa(m,j,d);d.sql&&(f.push("WHERE "+d.sql),b=b.concat(d.params));f.push(g);this.V=p;d=f.join(" ");T(e.qa,this+": opened: "+d+" : "+I(b));this.b.executeSql(d,
b,function(b,d){e.V=s;e.K=d;e.r=0;if(e.w&&a!=q)for(var f=yc(e.k(),a);-1==f||0==f&&c;)e.r++,f=yc(e.k(),a);e.q(e.k(),e.Y(),e.ea())},function(a,b){e.V=s;P(e.qa,"get error: "+b.message);e.$(b);return p})};v.Z=function(){return!!this.K&&this.r<this.K.rows.length};v.Y=function(){if(this.w&&this.r<this.K.rows.length){var a=this.K.rows.item(this.r),b;b=Ad(this.a,this.w).type;if(A(b)){for(var c=this.Tb,d=[],e=0;e<c.length;e++)d[e]=xd(a[c[e]],b[e]);return d}return xd(a[this.w],b)}};
v.k=function(){if(this.r<this.K.rows.length){var a=Bd(this.a),b=this.K.rows.item(this.r);return xd(b[a],this.a.type)}};v.ea=function(){this.w||Bd(this.a);if(this.r<this.K.rows.length&&!this.cb){var a=this.K.rows.item(this.r);return wd(a,this.a)}};
v.clear=function(a){this.Z()||k(new Dc);a&&k(new Mc);var b=new M,c=this;this.V=p;a=Bd(this.a);a="DELETE FROM "+Cd(this.a)+" WHERE "+a+" = ?";var d=[this.k()];T(c.qa,this+': clear "'+a+'" : '+I(d));this.b.executeSql(a,d,function(a,d){c.V=s;lb(b,d.rowsAffected)},function(a,d){c.V=s;P(c.qa,"get error: "+d.message);mb(b,d);return p});return b};
v.Jb=function(a,b){this.Z()||k(new Dc);b&&k(new Mc);var c=new M,d=this;this.V=p;var e=this.k(),f=Gd(d.a,a,e),g="REPLACE INTO "+Cd(this.a)+" ("+f.Ob.join(", ")+") VALUES ("+f.ec.join(", ")+") ON CONFLICT FAIL";T(d.qa,this+': clear "'+g+'" : '+I(f.z));this.b.executeSql(g,f.z,function(){d.V=s;lb(c,e)},function(a,b){d.V=s;P(d.qa,"get error: "+b.message);mb(c,b);return p});return c};v.hb=function(a,b){T(this.qa,this+" restarting.");this.wa(b,a,p)};
v.advance=function(a){this.Z()||k(new zc(this+" cursor gone."));this.r+=a;this.q(this.k(),this.Y(),this.ea())};
v.Va=function(a){this.Z()||k(new zc(this+" cursor gone."));var b=yc(a,this.k());(0==b||1==b&&this.reverse||-1==b&&!this.reverse)&&k(new zc(this+" wrong direction."));for(var c=this.Y(),d=this.K.rows.length,e=0;e<d;e++){if(0==b||1==b&&this.reverse||-1==b&&!this.reverse){this.q(this.k(),this.Y(),this.ea());return}this.r++;if(c&&c!=this.Y()){this.q(this.k(),this.Y(),this.ea());return}b=this.k();b=b!=q?yc(a,b):1}this.q(l,l,l)};
v.A=function(a){this.Z()||k(new zc(this+" cursor gone."));var b=yc(a,this.Hb());(0==b||1==b&&this.reverse||-1==b&&!this.reverse)&&k(new zc(this+" wrong direction."));for(var c=this.K.rows.length,d=0;d<c;d++){if(0==b||1==b&&this.reverse||-1==b&&!this.reverse){this.q(this.k(),this.Y(),this.ea());return}this.r++;b=this.Hb();b=b!=q?yc(a,b):1}this.q(l,l,l)};function xe(a,b){Jc.call(this,a,b)}G(xe,vd);xe.prototype.c=U("ydn.db.index.req.WebSql");xe.prototype.e=function(a,b,c,d,e,f){ye(this,a,c,d,p,e,f)};xe.prototype.d=function(a,b,c,d,e,f){ye(this,a,c,d,s,e,f)};
function ye(a,b,c,d,e,f,g){T(a.c,"fetchIterator:"+d);var h=X(a.a,d.J),j=d.ta(),m=z(j)?Ad(h,j):q,j=m?m.p():h.keyPath!=q?h.keyPath:"_ROWID_",n=K(j),r=m?m.type:h.type,m="*";e?m=n:d.U&&(m=Hd(h));var m=m+" FROM "+Cd(h),w="",y=[],D=Sa(j,r,d.gc());D.sql&&(w="WHERE "+D.sql,y=D.params);D="ASC";d.hc()&&(D="DESC");n="ORDER BY "+n;if(A(j))for(var n="ORDER BY ",V="",Q=0;Q<j.length;Q++)n+=V+'"'+K(j[Q])+'"',V=", ";j="";z(f)&&(j=" LIMIT "+f);z(g)&&(j+=" OFFSET "+g);var R=["SELECT",m,w,"",n,D,j].join(" "),O;O=e||
d.U?function(a){return xd(ze(a),r)}:function(a){return wd(a,h)};T(a.c,"SQL: "+R+" PARAMS: "+y);b.executeSql(R,y,function(b,d){for(var e=[],f=d.rows.length,g=0;g<f;g++){var h=d.rows.item(g);e.push(O(h))}T(a.c,"success "+R);c(e)},function(b,d){P(a.c,"error: "+R+" "+d.message);c(d,p);return s})}xe.prototype.b=function(a,b,c,d,e,f,g){b=X(this.a,c);var h=d;d&&(h=Ad(b,d).p());return new we(a,0,b,c,d,h,e,f,g)};function Ae(a,b){Jc.call(this,a,b)}G(Ae,rd);function Be(a,b,c,d){ge.call(this,a,b,c,d)}G(Be,he);v=Be.prototype;v.g=U("ydn.db.index.DbOperator");v.Ca=function(a,b){var c=this;if(a instanceof W){var d=pb(),e=a.J,f=X(this.b,e);f||k(new J('store "'+e+'" not found.'));var g=a.ta();z(g)&&!Vd(f,g)&&k(new J('index "'+g+'" not found in store "'+e+'".'));f=new M;f.L(function(a){lb(d,a[0])},function(a){mb(d,a)});S(this.g,"listByIterator:"+a);this.a.h(f,function(b,d,e){Y(c).d(b,d,e,a,1,0)},[e],N,"getByIterator");return d}return Be.S.Ca.call(this,a,b)};
v.keys=function(a,b,c,d,e){var f=this;if(a instanceof W){d=pb();var g=100;C(b)?(g=b,1>g&&k(new J("limit must be a positive value, but "+b))):z(b)&&k(new J("limit must be a number,  but "+b));var h=0;C(c)?h=c:z(c)&&k(new J("offset must be a number,  but "+c));S(this.g,"keysByIterator:"+a);this.a.h(d,function(b,c,d){Y(f).e(b,c,d,a,g,h)},a.stores(),N,"listByIterator");return d}return Be.S.keys.call(this,a,b,c,d,e)};
v.Ba=function(a,b,c){var d=this;return a instanceof W?((z(b)||z(c))&&k(new J("too many arguments.")),b=pb(),S(this.g,"countKeyRange:"+a),this.a.h(b,function(b,c,g){Y(d).ra(b,c,g,a.J,a.I,a.ta())},a.stores(),N,"countByIterator"),b):Be.S.Ba.call(this,a,b,c)};
v.z=function(a,b,c,d,e){var f=this;if(a instanceof W){d=pb();var g;C(b)?(g=b,1>g&&k(new J("limit must be a positive value, but "+g))):z(b)&&k(new J("limit must be a number, but "+b));var h;C(c)?h=c:z(c)&&k(new J("offset must be a number, but "+c));S(this.g,"listByIterator:"+a);this.a.h(d,function(b,c,d){Y(f).d(b,c,d,a,g,h)},a.stores(),N,"listByIterator");return d}return Be.S.z.call(this,a,b,c,d,e)};
v.nc=function(a,b,c){var d,e=pb(),f=[];for(d=0;d<a.length;d++)for(var g=a[d].stores(),h=0;h<g.length;h++)0<=Ua(f,g[h])||f.push(g[h]);T(this.g,this+": scan for "+a.length+" iterators on "+f);var j=c||[];for(d=0;d<j.length;d++)c=j[d].a,0<=Ua(f,c)||f.push(c);var m=this;this.a.h(e,function(c,d,e){function f(){for(var b=0,e=0;e<a.length;e++){var j=a[e],w=xc(j,c,d,Y(m));w.$=g;w.t=na(h,b);gb[e]=w;ub[b]=e;b++;for(var w=0,y=j.gb.length+1-1;w<y;w++){var Dd;Y(m);Dd=new pe(c,j.gb[w],j.sc[w]);Dd.cc(na(Q,b));Kb.push(Dd);
Na[b]=Kb.length;b++}}ea=a.length+Kb.length}function g(b){for(var c=0;c<a.length;c++)wc(a[c]);for(c=0;c<gb.length;c++)gb[c].B();Za(gb);Za(Kb);S(m.g,m+":tx"+d+": scanning error.");e(b,p)}function h(b,c,d,e){O&&k(new Nc);Lb++;var f=a[ub[b]];Gb[b]=B(f.index)?d:c;bc[b]=f.U?c:e;b=Na[b];c=0;for(f=f.gb.length+1-1;c<f;c++){var g=Kb[b+c],j=d,m=e;z(g.b)?g.push(m):g.push(j)}Lb===ea&&R()}function Q(a,b,c){O&&k(new Nc);Gb[a]=b;bc[a]=c;Lb++;Lb===ea&&R();return s}function R(){var c;c=b instanceof te?b.d(Gb,bc):b(Gb,
bc);var f=[],g=[],h=[],j=[];if(A(c))for(var n=0;n<c.length;n++)c[n]===p?h[n]=1:c[n]===s?j[n]=p:g[n]=c[n];else if(c===q)f=[];else if(z(c))E(c)?(f=c.continuePrimary||[],g=c["continue"]||[],h=c.advance||[],j=c.restart||[]):k(new Pc("scan callback output"));else{f=[];for(n=0;n<a.length;n++)z(ub[n])&&(h[n]=1)}for(n=Lb=c=0;n<a.length;n++)f[n]==q&&(g[n]==q&&j[n]==q&&h[n]==q)&&Lb++;for(n=0;n<a.length;n++)if(f[n]!=q||g[n]!=q||j[n]!=q||h[n]!=q){var y=ub[n];z(y)||k(new Pc(n+" is not an iterator."));var y=a[y],
D=gb[n];Gb[n]==q&&(h[n]===p||g[n]!=q||f[n]!=q)&&k(new zc(y+" at "+n+" must not advance."));Gb[n]=l;bc[n]=l;j[n]!=q?D.hb():g[n]!=q?D.A(g[n]):f[n]!=q?D.Va(f[n]):h[n]!=q?D.advance(1):k(new Nc(y+": has no action"));c++}if(0==c){for(f=0;f<a.length;f++)wc(a[f]);for(f=0;f<gb.length;f++)gb[f].B();O=p;Za(gb);Za(Kb);S(m.g,m+":tx"+d+": scanning success.");e(l)}}T(m.g,m+":tx"+d+": scanning started.");for(var O=s,ea,Na=[],ub=[],Gb=[],bc=[],gb=[],Kb=[],Lb=0,Ed=0;Ed<j.length;Ed++)qe(j[Ed],c);b instanceof te?b.b(a,
function(){f()})||f():f()},f,N,"join");return e};
v.mc=function(a,b,c){a instanceof W||k(new J("First argument must be cursor range iterator."));X(this.b,a.J)||k(new J('Store "'+a.J+'" not found.'));c=c||N;var d=this,e=pb();S(this.g,"open:"+c+" "+a);this.a.h(e,function(c,e,h){var j=xc(a,c,e,Y(d));j.$=function(b){wc(a);j.B();h(b,p)};j.t=function(c){c!=q?(c=b(j),c===p?j.hb(q,q):E(c)?c.restart===p?j.hb(c["continue"],c.continuePrimary):c["continue"]!=q?j.A(c["continue"]):c.continuePrimary!=q?j.Va(c.continuePrimary):(wc(a),j.B(),h(l)):j.advance(1)):(wc(a),
j.B(),h(l))}},a.stores(),c,"open");return e};v.map=function(a,b){for(var c=this,d=a.stores(),e,f=0;e=d[f];f++)e||k(new J('Store "'+e+'" not found.'));e=pb();T(this.g,"map:"+a);this.a.h(e,function(d,e,f){var m=xc(a,d,e,Y(c));m.$=function(a){f(a,s)};m.t=function(c,d,e){c!=q?(c=b(a.U?B(a.index)?d:c:B(a.index)?c:e),z(c)?(fa(c)&&k(new TypeError),c===q?f(l):m.A(c)):m.advance(1)):f(l)}},d,N,"map");return e};
v.reduce=function(a,b,c){for(var d=this,e=a.stores(),f,g=0;f=e[g];g++)f||k(new J('Store "'+f+'" not found.'));f=pb();var h=E(c)?sa(I(c)):c;S(this.g,"reduce:"+a);this.a.h(f,function(c,e,f){var g=xc(a,c,e,Y(d));g.$=function(a){f(a,p)};var w=0;g.t=function(c,d,e){c!=q?(h=b(h,a.U?B(a.index)?d:c:B(a.index)?c:e,w++),g.advance(1)):f(h)}},e,N,"map");return f};function Sd(a,b){var c;c=c||{};if(a==q||b==q)return s;if(A(a)&&A(b)){if(a.length!=b.length)return s;for(var d=0;d<a.length;d++)if(-1==Xa(b,function(b){return Sd(b,a[d])}))return s;return p}if(A(a))return 1==a.length&&Sd(a[0],b);if(A(b))return 1==b.length&&Sd(b[0],a);if(E(a)&&E(a)){for(var e in a)if(a.hasOwnProperty(e)&&!c[e]){var f=Sd(a[e],b[e]);if(!f)return s}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=Sd(a[e],b[e]),!f))return s;return p}return a===b}
function ze(a){for(var b in a)if(a.hasOwnProperty(b))return a[b]};function Ce(a){this.a=a}Ce.prototype.a=[];
Ce.prototype.b=function(a,b){for(var c=[],d=0;d<this.a.length;d++){var e=this.a[d],f="'"===e[0]&&"'"===e[e.length-1];if('"'===e[0]&&'"'===e[e.length-1])e=wb(a,Ca(e,'"').split(".")),c.push(e);else if(f)c.push(Ca(e,"'"));else if(B(e))if("true"===e)c.push(p);else if("false"===e)c.push(s);else if("Date"===e)c.push(new Date(parseInt(c.pop(),10)));else if("now"===e)c.push(new Date);else if("!"===e)c[c.length-1]=!c[c.length-1];else if("=="===e)c.push(c.pop()==c.pop());else if("==="===e)c.push(c.pop()===
c.pop());else if("!="===e)c.push(c.pop()!=c.pop());else if("!=="===e)c.push(c.pop()!==c.pop());else if("<="===e)c.push(c.pop()<=c.pop());else if("<"===e)c.push(c.pop()<c.pop());else if(">="===e)c.push(c.pop()>=c.pop());else if(">"===e)c.push(c.pop()>c.pop());else if("&"===e)c.push(c.pop()&c.pop());else if("|"===e)c.push(c.pop()|c.pop());else if("?"===e){var e=!!c.pop(),f=c.pop(),g=c.pop(),e=e?f:g;c.push(e)}else"+"===e?c.push(c.pop()+c.pop()):"-"===e?c.push(c.pop()-c.pop()):"*"===e?c.push(c.pop()*
c.pop()):"/"===e?c.push(c.pop()/c.pop()):"%"===e?c.push(c.pop()%c.pop()):"at"===e?(f=c.pop(),e=c.pop(),c.push(e[f])):"of"===e?(f=c.pop(),e=c.pop(),e=A(e)?e.indexOf(f):-1,c.push(e)):"in"===e?(f=c.pop(),e=c.pop(),e=A(e)?0<=e.indexOf(f):s,c.push(e)):"abs"===e?c[c.length-1]=Math.abs(c[c.length-1]):"$"==e[0]&&/^\$\d$/.test(e)?(e=parseInt(e.match(/^\$(\d)$/)[1],10),c.push(arguments[e])):c.push(parseFloat(e));else c.push(e)}return c[0]};
Ce.prototype.d=function(){return function(){var a=2<arguments.length?Array.prototype.slice(arguments,2):l;return Ce.prototype.b.apply(q,a)}};Ce.prototype.toJSON=function(){return{Tokens:sa(I(this.a))}};function De(a){B(a)||k(new Kc);this.W=a;Ee(this,a);this.Pa=""}v=De.prototype;v.W="";v.Qa=N;v.Xb=NaN;v.Zb=NaN;v.Db=s;v.Pa="";
function Ee(a,b){var c=b.split(/\sFROM\s/i);2!=c.length&&k(new Hc("FROM required."));var d=c[1],c=c[0].match(/\s*?(SELECT|INSERT|UPDATE|DELETE)\s+(.*)/i);3!=c.length&&k(new Hc("Unable to parse: "+b));a.d=c[1].toUpperCase();"SELECT"==a.d?a.Qa=N:"INSERT"==a.d?a.Qa=sb:"UPDATE"==a.d?a.Qa=sb:"DELETE"==a.d?a.Qa=sb:k(new Hc("Unknown SQL verb: "+a.d));var c=c[2].trim(),e=c.match(/^(MIN|MAX|COUNT|AVG|SUM)/i);e?(a.e=e[0].toUpperCase(),c=c.replace(/^(MIN|MAX|COUNT|AVG|SUM)/i,"").trim()):a.e=l;"("==c.charAt(0)&&
(")"==c.charAt(c.length-1)?c=c.substring(1,c.length-1):new Hc("missing closing parentheses"));a.O=c;c=d.search(/(ORDER BY|LIMIT|OFFSET)/i);0<c?(a.a=d.substring(c),d=d.substring(0,c)):a.a="";c=d.search(/WHERE/i);0<c?(a.i=d.substring(c+6).trim(),d=d.substring(0,c)):a.i="";a.b=d.trim().split(",").map(function(a){a=Ca(a,'"');a=Ca(a,"'");return a.trim()})}
v.parse=function(a){if(a){for(var b=0;b<a.length;b++)this.W=this.W.replace("?",a[b]);Ee(this,this.W)}this.l=Fe(this);if(!this.l)return this.Pa;a=this.a.length;if(b=/OFFSET\s+(\d+)/i.exec(this.a))this.Zb=parseInt(b[1],10),a=this.a.search(/OFFSET/i);if(b=/LIMIT\s+(\d+)/i.exec(this.a))this.Xb=parseInt(b[1],10),b=this.a.search(/LIMIT/i),b<a&&(a=b);(a=/ORDER BY\s+(.+)/i.exec(this.a.substr(0,a)))?(a=a[1].trim(),(b=a.match(/(ASC|DESC)/i))?(this.Db="DESC"==b[0].toUpperCase(),a=a.replace(/\s+(ASC|DESC)/i,
"")):this.Db=s,this.N=Ca(Ca(a,'"'),"'")):this.N=l;return""};function Ge(a){if("*"==a.O)return q;a=a.O.split(",");return a=a.map(function(a){return Ca(a.trim(),'"')})}v.toJSON=function(){return{sql:this.W}};
function Fe(a){function b(a){return Ya(c,function(b){return b.ca==a})}var c=[],d=/(.+?)(<=|>=|=|>|<)(.+)/i;if(0<a.i.length)for(var e=a.i.split("AND"),f=0;f<e.length;f++){var g=e[f],h=d.exec(g);if(h){var j=h[1].trim(),j=Ca(j,'"'),j=Ca(j,"'");if(0<j.length){var m=h[3].trim(),m=0==m.lastIndexOf('"',0)?Ca(m,'"'):0==m.lastIndexOf("'",0)?Ca(m,"'"):parseFloat(m),h=new Ra(j,h[2],m),j=b(j);if(0<=j){if(c[j]=c[j].rb(h),!c[j])return a.Pa='where clause "'+g+'" conflict',q}else c.push(h)}else return a.Pa='Invalid clause "'+
g+'"',q}else return a.Pa='Invalid clause "'+g+'"',q}return c}v.toString=function(){return De.S.toString.call(this)};function He(a,b){this.sql=b;this.a=a}He.prototype.toJSON=function(){return{sql:this.sql}};He.prototype.toString=u("idb.Node:");
He.prototype.pc=function(a,b,c,d){var e=ab(this.sql.b)[0],f=this.sql.l,g=this.sql.Xb,g=isNaN(g)?100:g,h=this.sql.Zb,h=isNaN(h)?0:h,j=this.sql.N,m=Ge(this.sql),n=q,r=this.sql.Db;0==f.length?n=q:1==f.length?n=ta(f[0].a):k(new Lc("too many conditions."));var w=c;m===q||(w=function(a,b){if(b)c(a,p);else{var d=a.map(function(a){var b=m.length;if(1==b)return Fa(a,m[0]);for(var c={},d=0;d<b;d++)c[m[d]]=Fa(a,m[d]);return c});c(d)}});j&&j!=this.a.p()?d.Ma(a,b,w,e,j,n,r,g,h,s):0<f.length&&f[0].ca!=this.a.p()?
d.Ma(a,b,w,e,f[0].ca,n,r,g,h,s):d.Na(a,b,w,e,n,r,g,h)};function Ie(a,b){He.call(this,a,b)}G(Ie,He);
Ie.prototype.pc=function(a,b,c,d){var e,f=ab(this.sql.b)[0],g=this.sql.l,h=q;0==g.length?h=q:1==g.length?h=ta(g[0].a):k(new Lc("too many conditions."));var j=this.sql.e;if("COUNT"==j)h?d.ra(a,b,c,f,h,g[0].ca):d.ra(a,b,c,f,q);else{var m,n=Ge(this.sql);(!n||0==n.length)&&k(new zc("field name require for reduce operation: "+j));var r=n[0];"MIN"==j?m=function(a,b){var c=a[r];return!z(b)?c:b<c?b:c}:"MAX"==j?m=function(a,b){var c=a[r];return!z(b)?c:b>c?b:c}:"AVG"==j?(e=0,m=function(a,b,c){z(b)||(b=0);return(b*
c+a[r])/(c+1)}):"SUM"==j?(e=0,m=function(a,b){return b+a[r]}):k(new Lc(j));var w=xc(h?new vc(f,g[0].ca,h):new uc(f),a,b,d);w.$=function(a){c(a,p)};var y=0;w.t=function(a,b,d){z(b)?(e=m(d,e,y),w.advance(1),y++):c(e)}}};function Je(a,b){Jc.call(this,a,b)}G(Je,ve);Je.prototype.c=U("ydn.db.sql.req.IndexedDb");Je.prototype.executeSql=function(a,b,c,d,e){(e=d.parse(e))&&k(new Hc(e));e=ab(d.b);if(1==e.length){var f=X(this.a,e[0]);f||k(new Ec(e[0]));var g=Ge(d);if(g)for(var h=0;h<g.length;h++)Vd(f,g[h])||k(new Ec('Index "'+g[h]+'" not found in '+e[0]));(d.e?new Ie(f,d):new He(f,d)).pc(a,b,c,this)}else k(new Lc(d.W))};function Ke(a,b){this.sql=b;this.d=a;this.a=Ge(b)}Ke.prototype.b=U("ydn.db.sql.req.websql.Node");Ke.prototype.toJSON=function(){return{sql:this.sql.W}};Ke.prototype.toString=u("websql.Node:");function Le(a,b){if(a.a){if(1==a.a.length){if(E(b))return wb(b,a.a[0]);return}for(var c={},d=0;d<a.a.length;d++)c[a.a[d]]=wb(b,a.a[d]);return c}return wd(b,a.d)}
Ke.prototype.qc=function(a,b,c){var d=this,e=[];b.executeSql(this.sql.W,c,function(b,c){for(var h=c.rows.length,j=0;j<h;j++){var m=c.rows.item(j);if(E(m))var n=Le(d,m);e.push(n)}a(e)},function(b,c){P(d.b,"Sqlite error: "+c.message);a(c,p);return p})};function Me(a,b){Ke.call(this,a,b)}G(Me,Ke);Me.prototype.qc=function(a,b,c){var d=this;b.executeSql(this.sql.W,c,function(b,c){var d=c.rows.length;1==d?(d=ze(c.rows.item(0)),a(d)):0==d?a(l):k(new Bc)},function(b,c){P(d.b,"Sqlite error: "+c.message);a(c,p);return p})};function Ne(a,b){Jc.call(this,a,b)}G(Ne,xe);Ne.prototype.c=U("ydn.db.sql.req.WebSql");Ne.prototype.executeSql=function(a,b,c,d,e){b=ab(d.b);if(1==b.length){var f=X(this.a,b[0]);f||k(new Ec(b[0]));var g=Ge(d);if(g)for(var h=0;h<g.length;h++)Vd(f,g[h])||k(new Ec('Index "'+g[h]+'" not found in '+b[0]));(d.e?new Me(f,d):new Ke(f,d)).qc(c,a,e)}else k(new Lc(d.W))};function Oe(a,b){Jc.call(this,a,b)}G(Oe,Ae);function Pe(a,b,c,d){ge.call(this,a,b,c,d)}G(Pe,Be);Pe.prototype.executeSql=function(a,b){for(var c=pb(),d=new De(a),e=ab(d.b),f=0;f<e.length;f++){var g=X(this.b,e[f]);g||k(new J("store: "+g+" not exists."))}var h=this;S(this.g,"executeSql: "+a+" params: "+b);this.a.h(c,function(a,c,e){Y(h).executeSql(a,c,e,d,b||[])},ab(d.b),d.Qa,"executeSql");return c};function Qe(){this.clear()}v=Qe.prototype;v.setItem=function(a,b){z(this.a[a])||(this.keys.push(a.toString()),this.length=this.keys.length);this.a[a]=b};v.getItem=function(a){return this.a[a]||q};v.removeItem=function(a){delete this.a[a];$a(this.keys,a.toString());this.length=this.keys.length};v.length=0;v.key=function(a){a=this.keys[a];return z(a)?this.a[a]:q};v.clear=function(){this.a={};this.keys=[];this.length=0};function Re(a){this.f=a||new Qe}v=Re.prototype;v.jc=U("ydn.db.con.SimpleStorage");v.Fb=u(1);v.za=function(a,b){this.sa=a;this.d=b;this.a={};for(var c=0;c<b.stores.length;c++){var d=b.b(c);this.a[d.getName()]=d.toJSON()}this.indexes={};d=Se(this);if(c=sa(this.f.getItem(d)))for(var e in c)c.hasOwnProperty(e)&&!Zd(b,e)&&(d=c[e],b.a()?(S(this.jc,"Adding existing store: "+e),this.a[e]=d):(S(this.jc,"Deleting old store: "+e),ud(this,e)));else this.f.setItem(d,I(this.a));return ob(1)};v.kb=function(){return!!this.sa};
v.Aa=u("memory");v.jb=aa();v.Xa=function(a,b,c,d){a(this);d("complete",{})};v.X=function(a){qd(function(){for(var b=[],c=this.f.getItem(Se(this)).stores,d=0;d<c.length;d++){var e=this.f.getItem(Se(this,c[d]));b[d]=new Td(c[d],e.keyPath,e.autoIncrement)}b=new Xd(this.sa,b);a(b)},0,this)};function Se(a,b,c){a=["ydn.db",a.sa];z(b)&&(a.push(b),z(c)&&a.push(Ha(c)));return a.join("^|")}function td(a,b,c){b=Se(a,b instanceof Td?b.name:b,c);a=a.f.getItem(b);return a=a===q?l:sa(a)}
function sd(a,b,c,d){var e;e=X(a.d,c);d=z(d)?d:e.keyPath!=q?wb(b,e.a):l;z(d)||(e.autoIncrement?(Se(a,e.name),d=a.a[e.name],z(d.autoIncrementNo)||(d.autoIncrementNo=a.ab(e.name,q).length),d.autoIncrementNo++,d=d.autoIncrementNo):k(new Ac));e=d;d=Se(a,c,e);b=I(b);a.f.setItem(d,b);if(a=a.a[c].Keys){c=0;for(b=a.length;c<b&&e!=a[c];c++)if(e>a[c]){bb(a,c,0,e);break}}return e}
function ud(a,b,c){if(z(c))a.f.removeItem(Se(a,b,c)),a=a.a[b].Keys,z(a)&&$a(a,c);else if(z(b)){a.a[b]&&(a.a[b].Keys=q);c=Se(a,b)+"^|";for(b=a.f.length-1;0<=b;b--){var d=a.f.key(b);0==d.lastIndexOf(c,0)&&a.f.removeItem(d)}}else{c=Se(a)+"^|";for(b=a.f.length-1;0<=b;b--)d=a.f.key(b),0==d.lastIndexOf(c,0)&&a.f.removeItem(d)}}
v.index=function(a){var b=this.a[a],c=b.Keys;if(c==q){c=[];a=Se(this,a);a+="^|";for(var d=0,e=this.f.length;d<e;d++){var f=this.f.key(d);if(0==f.lastIndexOf(a,0)){c.push(f);for(var f=0,g=b.indexes.length;f<g;f++);}}Ta.sort.call(c,fb);b.Keys=c;b.indexes={}}return c};
v.ab=function(a,b,c,d,e,f){function g(){return e?function(a){return a>c}:function(a){return a>=c}}function h(){return f?function(a){return a<=d}:function(a){return a<d}}b!=q&&k(new Mc);a=this.index(a);if(!z(c)&&!z(d))return a;if(z(c)){if(z(d)){b=Ya(a,h());var j=Ya(a,g());return a.slice(b,j)}b=Ya(a,g());return a.slice(b)}b=Ya(a,h());return a.slice(0,b)};function Te(){Re.call(this,window.localStorage)}G(Te,Re);Te.prototype.Aa=u("localstorage");function Ue(){Re.call(this,window.sessionStorage)}G(Ue,Re);Ue.prototype.Aa=u("sessionstorage");var ke="created",ne="deleted",me="updated";function Ve(a,b){Yc.call(this,a,b)}G(Ve,Yc);Ve.prototype.N=t("i");function We(a,b,c,d,e){Yc.call(this,a,b);this.version=c;this.lc=d;this.kc=e}G(We,Ve);v=We.prototype;v.name="StorageEvent";v.version=NaN;v.lc=NaN;v.kc=q;v.Qc=t("version");v.yc=t("lc");v.Pc=t("kc");function le(a,b,c,d,e){Yc.call(this,a,b);this.i=c;this.key=d;this.value=e}G(le,Ve);le.prototype.name="RecordEvent";le.prototype.l=t("key");le.prototype.O=t("value");
function je(a,b,c,d,e){Yc.call(this,a,b);this.i=c;this.keys=d;this.z=e}G(je,Ve);je.prototype.name="StoreEvent";je.prototype.ab=t("keys");je.prototype.l=t("z");function fe(a,b){Xd.call(this,a,b)}G(fe,Xd);fe.prototype.a=u(p);/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");
*/
function Z(a,b,c){Sc.call(this);c=c||{};this.zc=c.mechanisms||Xe;this.La=c.size;this.fc=z(c.fc)?c.fc:s;this.b=this.fb=q;this.l=[];this.bb=s;if(b instanceof Xd)c=b;else if(E(b)){c=c.autoSchema||!z(b.stores)?new fe(b):new Xd(b);for(var d=0,e=b.stores?b.stores.length:0;d<e;d++){var f=X(c,b.stores[d].name);b.stores[d].Sync&&P(this.i,"Synchronization option for "+f.getName()+" ignored.")}}else c=new fe;this.a=c;z(a)&&this.va(a)}G(Z,od);Z.prototype.i=U("ydn.db.con.Storage");
Z.prototype.Ac=function(a){if(z(a)){var b=function(b){a(b.toJSON())};if(this.b)this.b.X(b);else{var c=this;this.transaction(function(a){c.b.X(b,a)},q,N)}}return this.a?this.a.toJSON():q};function ie(a,b){var c=b instanceof Td?b:Ud(b),d=b.name,e=X(a.a,d);0==Wd(c,e).length?ob(s):(e=e?"update":"add",a.a instanceof fe?(a.a.stores.push(c),a.b?(a.b.jb(),a.b=q,Ye(a)):ob(s)):k(new Oc("Cannot "+e+" store: "+d+". Not auto schema generation mode.")))}
Z.prototype.va=function(a){this.b&&k(Error("Already defined with "+this.e));this.e=a;Ye(this)};Z.prototype.getName=t("e");var Xe=["indexeddb","websql","localstorage","sessionstorage","memory"];function Ze(a,b){return"indexeddb"==b?new ae(a.La):"websql"==b?new de(a.La):"localstorage"==b?new Te:"sessionstorage"==b?new Ue:"memory"==b?new Re:q}
function Ye(a){for(var b=q,c=a.zc,d=0;d<c.length;d++){var e=c[d].toLowerCase();if("indexeddb"==e&&ce){b=Ze(a,e);break}else if("websql"==e&&ga(x.openDatabase)){b=Ze(a,e);break}else if("localstorage"==e&&window.localStorage){b=Ze(a,e);break}else if("sessionstorage"==e&&window.sessionStorage){b=Ze(a,e);break}else if("memory"==e){b=Ze(a,e);break}}b===q&&k(new Oc("No storage mechanism found."));b.za(a.e,a.a).L(function(c){a.b=b;T(a.i,a+": ready.");a.Oc=NaN;var d=new We("ready",a,parseFloat(b.Fb()),parseFloat(c),
q);qd(function(){if(a.onReady)a.onReady(d);pd(a,d);$e(a)});b.b=function(){T(a.i,a+": disconnected.")}},function(b){P(a.i,a+": opening fail: "+b.message);mb(new M,b);var c=new We("ready",a,NaN,NaN,b);c.message=b.message;qd(function(){a.fb&&a.fb(c);pd(a,c);if(a.l){a.i.log(ic,"Purging "+a.l.length+" transactions request.",l);for(var d=a.l.shift();d;)d.Q("error",b),d=a.l.shift()}})})}v=Z.prototype;v.pa=function(){if(this.b)return this.b.Aa()};v.fb=q;
v.Nc=function(){this.b&&(this.b.jb(),this.b=q,T(this.i,this+" closed"))};v.Oc=NaN;function $e(a){var b=a.l.shift();b&&(T(a.i,"pop tx queue "+b.la.name),Z.prototype.transaction.call(a,b.la,b.Ec,b.mode,b.Q));oa()}v.bb=s;
v.transaction=function(a,b,c,d){var e=b;B(b)?e=[b]:b!=q||(e=q);if(!this.b||!this.b.kb()||this.bb){b=a;var f=d;T(this.i,"push tx queue "+b.name);this.l.push({la:b,Ec:e,mode:c,Q:f});oa()}else{var g=this,h=z(c)?c:N;h==tb&&(this.bb=p);this.b.Xa(function(b){a(b);a=q},e,h,function(a,b){ga(d)&&(d(a,b),d=l);h==tb&&(g.bb=s);$e(g)})}};v.toString=function(){return"ydn.db.con.Storage:"+this.b};function Md(){this.a=q;this.b=0}Md.prototype.e=U("ydn.db.tr.Mutex");Md.prototype.G=q;function af(a,b,c){if(!a.G||!a.mode||c!=a.mode||a.G.length!=b.length)return s;for(c=0;c<b.length;c++)if(-1==a.G.indexOf(b[c]))return s;return p}Md.prototype.Q=q;Md.prototype.toString=u("Mutex");function bf(a,b,c,d){this.a=a;this.i=b;this.b=ab(c);this.d=d;this.e=[]}bf.prototype.a=q;bf.prototype.abort=function(){this.a?this.a.abort():k(new Cc("transaction completed"))};bf.prototype.C=t("i");function cf(a,b,c){a.a?(b(a.a),c&&a.e.push(c)):k(new Qa("tx committed on ParallelTxExecutor"))};function df(a){this.f=a;this.b=0;this.Fa=this.R=q}v=df.prototype;v.R=q;v.Fa=q;v.nb=U("ydn.db.tr.Parallel");v.C=t("b");v.type=function(){return this.f.pa()};v.abort=function(){S(this.nb,this+": aborting");Kd(this.Fa)};v.ob=u(s);
v.xa=function(a,b,c,d){function e(c){h.b++;j=new bf(c,h.b,b,g);T(h.nb,h+":tx"+j.C()+I(b)+g+" begin");h.R=j;cf(h.R,a,d)}function f(a,b){T(h.nb,h+":tx"+j.C()+" committed");for(var c=j,d;d=c.e.shift();)d(a,b);c.a=q;c.b=q;c.e=q}var g=z(c)?c:N,h=this,j;this.R&&this.R.a&&this.ob(b,g)?cf(this.R,a,d):this.f.transaction(e,b,g,f)};v.h=function(a,b,c,d,e,f){var g=this;this.xa(function(c){function d(b,e){g.Fa=c;e?mb(a,b):lb(a,b);d=g.Fa=q}b(c,g.C(),d)},c,d,f)};v.toString=u("Parallel");function ef(a){df.call(this,a)}G(ef,df);ef.prototype.ob=u(s);ef.prototype.h=function(a,b,c,d,e,f){var g,h=s,j=new M;j.L(function(a){g=a},function(a){h=p;g=a});ef.S.h.call(this,j,b,c,d,e,function(b,c){h?mb(a,g):lb(a,g);f&&(f(b,c),f=l)})};function ff(a){Ld.call(this,a)}G(ff,Ld);ff.prototype.ja=U("ydn.db.tr.StrictOverflowSerial");ff.prototype.Kb=function(a,b){return af(this.P,a,b)};ff.prototype.Ub=function(){var a=this.P;return!!a&&af(a,0<this.a.length?this.a[0].G:q,0<this.a.length?this.a[0].mode:q)};function gf(a){df.call(this,a)}G(gf,df);gf.prototype.ob=function(a,b){var c;a:if(c=this.R,!c.G||!c.d||b!=c.d||c.b.length!=a.length)c=s;else{for(var d=0;d<a.length;d++)if(-1==c.b.indexOf(a[d])){c=s;break a}c=p}return c};function hf(a){Ld.call(this,a)}G(hf,Ld);hf.prototype.Kb=function(a,b){var c;a:if(c=this.P,!c.G||!c.mode||b!=c.mode&&(c.mode!=sb||b!=N)||a.length>c.G.length)c=s;else{for(var d=0;d<a.length;d++)if(-1==c.G.indexOf(a[d])){c=s;break a}c=p}return c};function jf(a){df.call(this,a)}G(jf,df);jf.prototype.ob=function(a,b){var c;a:if(c=this.R,!c.b||!c.d||b!=c.d&&(c.d!=sb||b!=N)||a.length>c.b.length)c=s;else{for(var d=0;d<a.length;d++)if(-1==c.b.indexOf(a[d])){c=s;break a}c=p}return c};function kf(a){df.call(this,a);this.a=s}G(kf,df);kf.prototype.a=s;kf.prototype.h=function(a,b,c,d,e,f){function g(c){function d(b,e){h.Fa=c;e?mb(a,b):lb(a,b);d=h.Fa=q}b(c,h.C(),d);b=q}var h=this;this.R&&this.R.a?cf(this.R,g,f):(this.a&&(oc(this.nb,"single thread has already committed the transaction"),k(new Cc)),this.a=p,this.xa(g,c,d,f))};function lf(a,b,c){Z.call(this,a,b,c);this.u=0;a="serial";c&&c.thread&&(a=Jd.indexOf(c.thread),-1==a&&k(new Kc("thread: "+c.thread)),a=Jd[a]);this.Ka=a;this.d=this.Lb(this.Ka,"base")}G(lf,Z);v=lf.prototype;v.u=0;v.Lb=function(a,b){this.u++;b=b||"branch"+this.u;var c=mf(this,a);return this.Oa(c,q,b)};v.C=function(){return this.d?this.d.C():NaN};v.Oa=function(a,b,c){return new ge(this,this.a,c||"",a)};
function mf(a,b){b=b||a.Ka;if("serial"==b)return new Ld(a,a.u++);if("parallel"==b)return new df(a,a.u++);if("atomic-parallel"==b)return new ef(a,a.u++);if("atomic-serial"==b)return new Nd(a,a.u++);if("samescope-multirequest-parallel"==b)return new gf(a,a.u++);if("samescope-multirequest-serial"==b)return new ff(a,a.u++);if("multirequest-parallel"==b)return new jf(a,a.u++);if("multirequest-serial"==b)return new hf(a,a.u++);if("single"==b)return new kf(a,a.u++);k(new J('invalid transaction policy thread type "'+
b+'"'))}v.abort=function(){return this.d.abort()};
v.Dc=function(a,b,c,d,e){var f=this;this.u++;var g=B(a.name)&&0<a.name.length?a.name:"run"+this.u,h=mf(this,"single"),j=this.Oa(h,q,g),m=c||N;b!=q||(b=Yd(this.a));var n=a;if(4<arguments.length)var r=Array.prototype.slice.call(arguments,4),n=function(){var b=Array.prototype.slice.call(arguments),b=b.concat(r);return a.apply(this,b)};T(this.i,"scheduling run in transaction "+g+" with "+h);h.xa(function(){T(f.i,"executing run in transaction "+g);n(j);n=q},b,m,d)};function $(a,b,c){lf.call(this,a,b,c)}G($,lf);v=$.prototype;v.Oa=function(a,b,c){return new he(this,this.a,c||"",a)};v.yb=function(){var a=this.pa();if("indexeddb"==a)return new Qc(this.e,this.a);if("websql"==a)return new vd(this.e,this.a);if("memory"==a||"localstorage"==a||"sessionstorage"==a)return new rd(this.e,this.a);k(new Bc("No executor for "+a))};v.lb=function(a,b,c){return this.d.lb(a,b,c)};v.Ba=function(a,b,c){return this.d.Ba(a,b,c)};v.Ca=function(a,b){return this.d.Ca(a,b)};
v.keys=function(a,b,c,d,e,f){return this.d.keys(a,b,c,d,e,f)};v.z=function(a,b,c,d,e,f){return this.d.z(a,b,c,d,e,f)};v.Da=function(a,b,c){return this.d.Da(a,b,c)};v.clear=function(a,b,c){return this.d.clear(a,b,c)};v.mb=function(a,b,c){return this.d.mb(a,b,c)};v.toString=function(){return"Storage:"+this.getName()};function nf(a,b,c){lf.call(this,a,b,c)}G(nf,$);v=nf.prototype;v.yb=function(){var a=this.pa();if("indexeddb"==a)return new ve(this.e,this.a);if("websql"==a)return new xe(this.e,this.a);if("memory"==a||"localstorage"==a||"sessionstorage"==a)return new Ae(this.e,this.a);k(new Bc("No executor for "+a))};v.Oa=function(a,b,c){return new Be(this,this.a,c||"",a)};v.Rc=function(a,b,c){return this.d.mc(a,b,c)};v.Sc=function(a,b,c){return this.d.nc(a,b,c)};v.map=function(a,b){return this.d.map(a,b)};
v.reduce=function(a,b,c){return this.d.reduce(a,b,c)};function of(a,b,c){lf.call(this,a,b,c)}G(of,nf);of.prototype.yb=function(){var a=this.pa();if("indexeddb"==a)return new Je(this.e,this.a);if("websql"==a)return new Ne(this.e,this.a);if("memory"==a||"localstorage"==a||"sessionstorage"==a)return new Oe(this.e,this.a);k(new Bc("No executor for "+a))};of.prototype.Oa=function(a,b,c){return new Pe(this,this.a,c||"",a)};of.prototype.executeSql=function(a,b){return this.d.executeSql(a,b)};function pf(a,b,c){lf.call(this,a,b,c)}G(pf,of);function qf(a,b){te.call(this,a,b)}G(qf,te);qf.prototype.b=u(s);qf.prototype.d=function(a,b){function c(b){z(a[b])?(e=s,d[b]=p):(d[b]=s,0<=b-1&&c(b-1))}var d=[],e=p;c(a.length-1);e&&(d=[]);var f;a:{f=d;var g,h=g!=q;if(!z(g)){g=b[0];for(var h=g!=q,j=1;h&&j<b.length;j++)if(b[j]==q||0!=yc(b[j],g))h=s}if(h&&(this.i++,this.a&&this.a.push(g),z(this.l)&&this.i>=this.l)){f=[];break a}}return f};function rf(a,b){te.call(this,a,b);this.e=a instanceof pe&&!!a.ya}G(rf,te);rf.prototype.e=s;rf.prototype.b=function(a,b){var c=rf.S.b.call(this,a,b);if(this.e){var d=a[0].ta().split(", ");1<d.length&&d[d.length-1]!=this.a.ya&&k(new zc("Output streamer projection field must be same as postfix field in the iterator"))}return c};
rf.prototype.d=function(a,b){function c(a,b){var c=a.slice(0,a.length-1);c.push(b);return c}var d=[];if(0==a.length||a[0]==q||a[0]==q)return[];for(var e=p,f=0,g=a[f][a[f].length-1],h=[],j=1;j<a.length;j++)if(a[j]!=q){var m=a[j][a[j].length-1],n=yc(g,m);h[j]=n;1===n?e=s:-1===n&&(e=s,g=m,f=1)}else return[];if(e){for(e=0;e<a.length;e++)a[e]!=q&&(d[e]=p);this.a&&(this.e?this.a.push(b[0],g):this.a.push(b[0]));return d}if(0==f)for(e=1;e<a.length;e++)1===h[e]&&(d[e]=c(a[e],g));else for(e=0;e<a.length;e++)e!=
f&&a[e]!=q&&1===yc(g,a[e][a[e].length-1])&&(d[e]=c(a[e],g));return{"continue":d}};function sf(a,b){te.call(this,a,b)}G(sf,te);sf.prototype.b=u(s);sf.prototype.d=function(a,b){var c=[],d=b[0];if(d==q)return[];for(var e=p,f=s,g=d,h=[],j=1;j<a.length;j++)if(b[j]!=q){var m=yc(d,b[j]);h[j]=m;1===m?e=s:-1===m&&(e=s,f=p,1===yc(b[j],g)&&(g=b[j]))}else e=s,f=p;if(e)for(f=0;f<a.length;f++)b[f]!=q&&(c[f]=p);else if(f)for(f=0;f<a.length;f++)b[f]!=q&&1===yc(g,b[f])&&(c[f]=g);else for(f=1;f<a.length;f++)1===h[f]&&(c[f]=d);return e?(this.i++,this.a&&this.a.push(g),c):{continuePrimary:c}};F("ydn.db.Storage",pf);F("ydn.db.algo.NestedLoop",qf);F("ydn.db.algo.ZigzagMerge",rf);F("ydn.db.algo.SortedMerge",sf);M.prototype.done=M.prototype.fa;M.prototype.fail=M.prototype.Mb;M.prototype.then=M.prototype.L;M.prototype.always=M.prototype.rc;od.prototype.addEventListener=od.prototype.addEventListener;F("ydn.db.con.Storage",Z);Z.prototype.onReady=Z.prototype.fb;Z.prototype.getType=Z.prototype.pa;Z.prototype.setName=Z.prototype.va;Z.prototype.getName=Z.prototype.getName;Z.prototype.getSchema=Z.prototype.Ac;Z.prototype.transaction=Z.prototype.transaction;Z.prototype.close=Z.prototype.Nc;F("ydn.db.version","0.4.3");
F("ydn.db.deleteDatabase",function(a,b){ce&&((!b||"indexeddb"==b)&&ce&&"deleteDatabase"in ce)&&ce.deleteDatabase(a);if(ga(x.openDatabase)&&(!b||"websql"==b)){var c=new de,d=new fe;S(c.n,"deleting websql database: "+a);var d=c.za(a,d),e=function(){c.n.log(ic,"all tables in "+a+" deleted.",l)};d.fa(function(){c.Xa(function(b){c.X(function(d){var e=d.stores.length;if(0<e)for(var f=0;f<e;f++){var n=d.b(f);T(c.n,"deleting table: "+n.getName());b.executeSql("DROP TABLE "+Cd(n))}else c.n.log(ic,"no table to delete in "+
a,l)},b)},[],sb,e)});d.Mb(function(){P(c.n,"Connecting "+a+" failed.")})}if(!b||"localstorage"==b){var d=new Te,f=new fe;d.za(a,f);ud(d)}if(!b||"sessionstorage"==b)d=new Ue,f=new fe,d.za(a,f),ud(d)});We.prototype.name=We.prototype.name;We.prototype.getVersion=We.prototype.Qc;We.prototype.getOldVersion=We.prototype.yc;We.prototype.getError=We.prototype.Pc;lf.prototype.branch=lf.prototype.Lb;lf.prototype.run=lf.prototype.Dc;ge.prototype.abort=ge.prototype.abort;lf.prototype.abort=lf.prototype.abort;F("ydn.db.core.Storage",$);$.prototype.branch=$.prototype.Lb;$.prototype.add=$.prototype.lb;$.prototype.get=$.prototype.Ca;$.prototype.values=$.prototype.z;$.prototype.put=$.prototype.Da;$.prototype.clear=$.prototype.clear;$.prototype.remove=$.prototype.mb;$.prototype.count=$.prototype.Ba;he.prototype.add=he.prototype.lb;he.prototype.get=he.prototype.Ca;he.prototype.values=he.prototype.z;he.prototype.put=he.prototype.Da;he.prototype.clear=he.prototype.clear;he.prototype.remove=he.prototype.mb;
he.prototype.count=he.prototype.Ba;F("ydn.db.cmp",yc);F("ydn.db.Key",Ic);Ic.prototype.id=Ic.prototype.xc;Ic.prototype.parent=Ic.prototype.Lc;Ic.prototype.storeName=Ic.prototype.Mc;F("ydn.db.KeyRange",H);H.upperBound=function(a,b){return new H(l,a,l,b)};H.lowerBound=function(a,b){return new H(a,l,b,l)};H.bound=qa;H.only=function(a){return new H(a,a,s,s)};H.starts=ra;Ve.prototype.store_name=Ve.prototype.i;Ve.prototype.getStoreName=Ve.prototype.N;le.prototype.name=le.prototype.name;
le.prototype.getKey=le.prototype.l;le.prototype.getValue=le.prototype.O;je.prototype.name=je.prototype.name;je.prototype.getKeys=je.prototype.ab;je.prototype.getValues=je.prototype.l;nf.prototype.scan=nf.prototype.Sc;nf.prototype.map=nf.prototype.map;nf.prototype.reduce=nf.prototype.reduce;nf.prototype.open=nf.prototype.Rc;Be.prototype.scan=Be.prototype.nc;Be.prototype.map=Be.prototype.map;Be.prototype.reduce=Be.prototype.reduce;Be.prototype.open=Be.prototype.mc;se.prototype.key=se.prototype.Hb;ue.prototype.primaryKey=ue.prototype.k;ue.prototype.value=ue.prototype.ea;ue.prototype.update=ue.prototype.Jb;ue.prototype.clear=ue.prototype.clear;we.prototype.primaryKey=we.prototype.k;
we.prototype.value=we.prototype.ea;we.prototype.update=we.prototype.Jb;we.prototype.clear=we.prototype.clear;F("ydn.math.Expression",Ce);Ce.prototype.evaluate=Ce.prototype.b;Ce.prototype.compile=Ce.prototype.d;Ce.parseRpn=function(a){return new Ce(a.match(/[^\s"']+|"[^"]*"|'[^']*'/g))};Ce.parseInfix=function(){k(new Mc("Too lazy to learn Dutch in Shunting Yard station, we speak Polish here."))};F("ydn.db.Iterator",W);F("ydn.db.KeyCursors",sc);F("ydn.db.ValueCursors",uc);F("ydn.db.Cursors",tc);
F("ydn.db.IndexValueCursors",vc);W.prototype.count=W.prototype.Fc;W.prototype.done=W.prototype.wc;W.prototype.getKeyRange=W.prototype.gc;W.prototype.getIndexName=W.prototype.ta;W.prototype.getStoreName=W.prototype.Hc;W.prototype.isReversed=W.prototype.hc;W.prototype.isUnique=W.prototype.Jc;W.prototype.isKeyOnly=W.prototype.Ic;W.prototype.primaryKey=W.prototype.k;W.prototype.key=W.prototype.Gc;W.prototype.resume=W.prototype.Cc;W.prototype.reset=W.prototype.Kc;
sc.where=function(a,b,c,d,e){return new sc(a,va(b,c,d,e))};uc.where=function(a,b,c,d,e){return new uc(a,va(b,c,d,e))};tc.where=function(a,b,c,d,e,f){return new tc(a,b,va(c,d,e,f))};vc.where=function(a,b,c,d,e,f){return new vc(a,b,va(c,d,e,f))};F("ydn.db.Streamer",pe);pe.prototype.push=pe.prototype.push;pe.prototype.collect=pe.prototype.vc;pe.prototype.setSink=pe.prototype.cc;})();
